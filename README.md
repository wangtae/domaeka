# domaeka
도매까 쇼핑몰(영카트)

## 프로젝트 개요

도매까는 그누보드 5 기반의 본사-대리점-지점 계층 구조 관리 시스템입니다.

### 주요 기능
- **3단계 계층 구조**: 본사 → 대리점 → 지점
- **권한별 관리**: 각 계층별 데이터 접근 및 관리 권한 차별화
- **상품 소유권 관리**: 본사, 대리점, 지점 각각의 상품 등록 및 관리
- **통합 관리자 시스템**: 계층별 관리자 인터페이스

## 설치 및 설정

### 1. 데이터베이스 설정

```bash
# 1. 새 테이블 생성
mysql -u [사용자명] -p [데이터베이스명] < main/dmk/sql/001_create_dmk_tables.sql

# 2. 기존 테이블 수정
mysql -u [사용자명] -p [데이터베이스명] < main/dmk/sql/002_alter_existing_tables.sql

# 3. 테스트 데이터 생성 (선택사항)
mysql -u [사용자명] -p [데이터베이스명] < main/dmk/sql/005_insert_test_data.sql
```

### 2. ⚠️ 중요: 패스워드 암호화 방식 변경

테스트 데이터를 생성한 경우, **반드시** 다음 단계를 수행해야 합니다:

```bash
# 브라우저에서 다음 URL에 접근하여 패스워드 변경 스크립트 실행
http://[도메인]/main/dmk/sql/004_update_admin_passwords.php
```

**이유**: 테스트 데이터의 패스워드는 MySQL `PASSWORD()` 함수로 생성되어 그누보드5 표준 암호화 방식과 호환되지 않습니다.

#### 패스워드 형태 비교
- ❌ **MySQL 방식**: `*A4B6157319038724E35...` (로그인 불가)
- ✅ **그누보드5 방식**: `sha256:12000:BBz+Yx7...` (정상 로그인)

### 3. 테스트 계정

패스워드 변경 스크립트 실행 후 다음 계정으로 테스트 가능:

| 계정 | 패스워드 | 권한 | 소속 |
|------|---------|------|------|
| `agency_admin1` | `1234` | 대리점 관리자 | 서울중앙대리점 |
| `agency_admin2` | `1234` | 대리점 관리자 | 부산남부대리점 |
| `branch_admin1` | `1234` | 지점 관리자 | 강남1호점 |
| `branch_admin2` | `1234` | 지점 관리자 | 강남2호점 |
| `branch_admin3` | `1234` | 지점 관리자 | 해운대점 |

## 권한 체계

### 본사 관리자 (HQ)
- 모든 대리점, 지점 데이터 조회/관리
- 대리점 등록/수정/삭제
- 모든 상품 조회, 본사 상품만 수정

### 대리점 관리자 (AGENCY)
- 소속 지점들의 데이터 조회/관리
- 새 지점 등록 가능
- 본사/자신의 상품 조회, 자신의 상품만 수정

### 지점 관리자 (BRANCH)
- 자신의 데이터만 조회/관리
- 본사/소속대리점/자신의 상품 조회, 자신의 상품만 수정

## 파일 구조

```
main/dmk/
├── sql/                    # 데이터베이스 스크립트
│   ├── 001_create_dmk_tables.sql
│   ├── 002_alter_existing_tables.sql
│   ├── 003_rollback_tables.sql
│   ├── 004_update_admin_passwords.php  ⚠️ 중요
│   └── 005_insert_test_data.sql
├── adm/                    # 관리자 기능
│   ├── lib/
│   │   └── admin.auth.lib.php
│   ├── agency_admin/       # 대리점 관리
│   └── branch_admin/       # 지점 관리
└── docs/                   # 문서
    └── g5_modifications_log.md
```

## 개발 문서

- [단계별 개발 계획](docs/250623-단계별개발계획.md)
- [데이터베이스 스키마](docs/SCHEMA.md)
- [G5 수정 내역](main/dmk/docs/g5_modifications_log.md)

## 주의사항

1. **패스워드 스크립트 실행**: 테스트 데이터 생성 후 반드시 `004_update_admin_passwords.php` 실행
2. **보안**: 운영 환경에서는 패스워드 변경 스크립트를 삭제하세요
3. **백업**: 데이터베이스 변경 전 반드시 백업을 수행하세요
4. **롤백**: 문제 발생 시 `003_rollback_tables.sql` 사용 가능

