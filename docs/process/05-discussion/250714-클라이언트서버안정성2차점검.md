# ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ μ•μ •μ„± 2μ°¨ μ κ²€ λ³΄κ³ μ„

## μ‘μ„±μΌ: 2025-07-14
## μ κ²€ λ€μƒ
- **Domaeka μ„λ²„**: `/home/wangt/projects/client/domaeka/domaeka.dev/server` (domaeka.dev ν”„λ΅μ νΈ)
- **Kkobot μ„λ²„**: `/home/wangt/projects/personal/kkobot/kkobot.dev/server` (kkobot ν”„λ΅μ νΈ)  
- **κ³µν†µ ν΄λΌμ΄μ–ΈνΈ**: `/client/messengerbotR/bridge-v3.2.2.js`

> **μ°Έκ³ **: λ³Έ λ¬Έμ„μ—μ„ "κ²½λ‰ μ„λ²„"μ™€ "κ³ κΈ‰ μ„λ²„"λΌλ” ν‘ν„μ€ κΈ°λ¥μ λ³µμ΅λ„ μ°¨μ΄λ¥Ό μ„¤λ…ν•κΈ° μ„ν• κ²ƒμ…λ‹λ‹¤. Domaeka μ„λ²„κ°€ κ²½λ‰ μ„λ²„λ¥Ό μ§€ν–¥ν•λ” κ²ƒμ€ μ•„λ‹λ©°, λ‘ μ„λ²„μ κΈ°λ³Έ ν†µμ‹  μ‹μ¤ν…μ€ λ™μΌν•κ² μ μ§€λμ–΄μ•Ό ν•©λ‹λ‹¤. Kkobot μ„λ²„λ” λ¶€κ°€ κΈ°λ¥μ΄ λ§μ΄ μ¶”κ°€λμ–΄ λΉ„λ€ν•΄μ§„ κ²ƒμΌ λΏμ…λ‹λ‹¤.

## 1. μ•„ν‚¤ν…μ² λΉ„κµ λ¶„μ„

### 1.1 λ©”μ‹μ§€ μ²λ¦¬ λ°©μ‹ λΉ„κµ (μ—…λ°μ΄νΈ ν›„)

| κµ¬λ¶„ | Domaeka μ„λ²„ (server) | Kkobot μ„λ²„ (server-kkobot) | μƒνƒ |
|------|-------------------|-------------------------|------|
| **μ²λ¦¬ ν¨ν„΄** | μ›μ»¤ ν ν¨ν„΄ (λΉ„λ™κΈ°) | μ›μ»¤ ν ν¨ν„΄ (λΉ„λ™κΈ°) | β… λ™μΌ |
| **λ™μ‹ μ²λ¦¬** | 31κ° μ›μ»¤ μ ν• | 31κ° μ›μ»¤ μ ν• | β… λ™μΌ |
| **λ©”μ‹μ§€ ν** | asyncio.Queue μ‚¬μ© | asyncio.Queue μ‚¬μ© | β… λ™μΌ |
| **μ²λ¦¬ μ§€μ—°** | λ³΄ν†µ (ν λ€κΈ°) | λ³΄ν†µ (ν λ€κΈ°) | β… λ™μΌ |
| **λ¶€ν• λ¶„μ‚°** | μ›μ»¤κ°„ μλ™ λ¶„μ‚° | μ›μ»¤κ°„ μλ™ λ¶„μ‚° | β… λ™μΌ |
| **λ°±ν”„λ μ…”** | ν ν¬κΈ° μ ν• (10000) | ν ν¬κΈ° μ ν• | β… λ™μΌ |

> **κµ¬ν„ μ™„λ£**: Domaeka μ„λ²„λ„ μ΄μ  Kkobot μ„λ²„μ™€ λ™μΌν• μ›μ»¤ ν ν¨ν„΄μ„ μ‚¬μ©ν•©λ‹λ‹¤. 31κ°μ μ›μ»¤κ°€ asyncio.Queueλ¥Ό ν†µν•΄ λ©”μ‹μ§€λ¥Ό λΉ„λ™κΈ°μ μΌλ΅ μ²λ¦¬ν•©λ‹λ‹¤.

### 1.2 μ—°κ²° κ΄€λ¦¬ λΉ„κµ

| κµ¬λ¶„ | Domaeka μ„λ²„ | Kkobot μ„λ²„ | μƒνƒ |
|------|----------|----------|------|
| **ν΄λΌμ΄μ–ΈνΈ μ¶”μ ** | β… (bot_name, device_id) κΈ°λ° | β… (bot_name, device_id) κΈ°λ° | β… κµ¬ν„ μ™„λ£ |
| **ν•Έλ“μ…°μ΄ν¬** | β… λ””λ°”μ΄μ¤ μΉμΈ μ‹μ¤ν… | β… λ””λ°”μ΄μ¤ μΉμΈ μ‹μ¤ν… | β… λ™μΌ |
| **ν•Έλ“μ…°μ΄ν¬ νƒ€μ„μ•„μ›ƒ** | β… 10μ΄ νƒ€μ„μ•„μ›ƒ | β… 10μ΄ νƒ€μ„μ•„μ›ƒ | β… λ™μΌ |
| **μΈμ¦ λ°©μ‹** | β… HMAC + DB μΉμΈ | β… HMAC + DB μΉμΈ | β… λ™μΌ |
| **ping λ¨λ‹ν„°λ§** | β… kb_ping_monitor μ €μ¥ | β… kb_ping_monitor μ €μ¥ | β… λ™μΌ |
| **μ„¤μ • κ΄€λ¦¬** | μλ™ | μλ™ μƒμ„± (λ΄‡λ³„) | π† κ³ κΈ‰ |
| **μ¬μ—°κ²° μ²λ¦¬** | ν΄λΌμ΄μ–ΈνΈ μμ΅΄ | ν΄λΌμ΄μ–ΈνΈ μμ΅΄ | β–οΈ λ™λ“± |

> **κµ¬ν„ μ™„λ£ (2025-07-14)**: 
> - μ–‘μ½ μ„λ²„ λ¨λ‘ `(bot_name, device_id)` κΈ°λ° ν΄λΌμ΄μ–ΈνΈ μ¶”μ  κµ¬ν„
> - Domaeka μ„λ²„μ— Kkobot μ„λ²„μ™€ λ™μΌν• ν•Έλ“μ…°μ΄ν¬ λ° μΈμ¦ λ°©μ‹ μ μ©
> - ν•Έλ“μ…°μ΄ν¬ νƒ€μ„μ•„μ›ƒ(10μ΄) λ° μ½κΈ° νƒ€μ„μ•„μ›ƒ(30μ΄) κµ¬ν„
> - ping μ΄λ²¤νΈ λ¨λ‹ν„°λ§ λ° DB μ €μ¥ κΈ°λ¥ μ¶”κ°€

#### ν΄λΌμ΄μ–ΈνΈ μ¶”μ  λ°©μ‹ κ°μ„  μ™„λ£ (2025-07-14)

**β… Domaeka μ„λ²„μ κ°μ„ λ ν΄λΌμ΄μ–ΈνΈ μ¶”μ **:
```python
# core/globals.py
clients = {}  # {(bot_name, device_id): writer} - bot_nameκ³Ό device_idλ΅ ν΄λΌμ΄μ–ΈνΈ μ¶”μ 
clients_by_addr = {}  # {(ip, port): (bot_name, device_id)} - μ£Όμ†λ΅ ν΄λΌμ΄μ–ΈνΈ μ°ΎκΈ°μ©

# ν΄λΌμ΄μ–ΈνΈ λ“±λ΅ μμ‹ (core/client_handler.py)
client_key = (bot_name, device_id)
g.clients[client_key] = writer
g.clients_by_addr[client_addr] = client_key
```

**β… Kkobot μ„λ²„μ κ°μ„ λ ν΄λΌμ΄μ–ΈνΈ μ¶”μ **:
```python
# core/globals.py
clients = {}  # {(bot_name, device_id): {addr: writer}} - bot_nameκ³Ό device_idλ΅ ν΄λΌμ΄μ–ΈνΈ μ¶”μ 
clients_by_addr = {}  # {addr: (bot_name, device_id)} - μ£Όμ†λ΅ ν΄λΌμ΄μ–ΈνΈ μ°ΎκΈ°μ©

# ν΄λΌμ΄μ–ΈνΈ λ“±λ΅ μμ‹ (core/client_handler.py)
client_key = (bot_name, device_id)
g.clients.setdefault(client_key, {})[addr] = writer
g.clients_by_addr[addr] = client_key
```

**κ°μ„  ν¨κ³Ό**:
1. **λ¨λ°”μΌ ν™κ²½ λ€μ‘**:
   - IP λ³€κ²½ μ‹μ—λ„ λ™μΌν• λ””λ°”μ΄μ¤λ΅ μΈμ‹
   - WiFi β†” λ¨λ°”μΌ λ°μ΄ν„° μ „ν™ μ‹ μ—°μ†μ„± μ μ§€
   
2. **λ°μ΄ν„°λ² μ΄μ¤ μΌμΉμ„±**:
   - `kb_bot_devices` ν…μ΄λΈ” κµ¬μ΅°μ™€ λ™μΌν• ν‚¤ μ‚¬μ©
   - λ””λ°”μ΄μ¤ κ΄€λ¦¬μ μΌκ΄€μ„± ν™•λ³΄
   
3. **κΈ°μ΅΄ μ—°κ²° κ΄€λ¦¬ κ°μ„ **:
   - λ™μΌν• λ””λ°”μ΄μ¤ μ¬μ—°κ²° μ‹ κΈ°μ΅΄ μ—°κ²° μλ™ μ •λ¦¬
   - μΆ€λΉ„ μ—°κ²° λ°©μ§€

> **κµ¬ν„ μ™„λ£**: 2025-07-14 κΈ°μ¤€μΌλ΅ μ–‘μ½ μ„λ²„ λ¨λ‘ `(bot_name, device_id)` λ³µν•© ν‚¤λ΅ ν΄λΌμ΄μ–ΈνΈ μ¶”μ μ΄ ν†µμΌλμ—μµλ‹λ‹¤.

### 1.3 λ¦¬μ†μ¤ κ΄€λ¦¬ λΉ„κµ

| κµ¬λ¶„ | Domaeka μ„λ²„ | Kkobot μ„λ²„ | μƒνƒ |
|------|----------|----------|------|
| **λ™μ‹μ„± μ μ–΄** | β… μ„Έλ§ν¬μ–΄ (λ΄‡/λ°©λ³„) | β… μ„Έλ§ν¬μ–΄ (λ΄‡/λ°©λ³„) | β… λ™μΌ |
| **λ©”λ¨λ¦¬ μ‚¬μ©** | λ‚®μ | λ†’μ | π† κ²½λ‰ |
| **CPU μ‚¬μ©** | ν¨μ¨μ  | μ¤λ²„ν—¤λ“ μμ | π† κ²½λ‰ |
| **λ¦¬μ†μ¤ λ¨λ‹ν„°λ§** | β… DB μ €μ¥ (5λ¶„) | β… DB μ €μ¥ (5λ¶„) | β… λ™μΌ |
| **κ³Όλ¶€ν• λ³΄νΈ** | β… λ‹¤λ‹¨κ³„ μ ν• | β… λ‹¤λ‹¨κ³„ μ ν• | β… λ™μΌ |

> **κµ¬ν„ μ™„λ£ (2025-07-14)**: Domaeka μ„λ²„μ—λ„ λ΄‡λ³„/λ°©λ³„ μ„Έλ§ν¬μ–΄ κΈ°λ° λ™μ‹μ„± μ μ–΄κ°€ κµ¬ν„λμ—μµλ‹λ‹¤:
> - λ΄‡λ³„ μµλ€ 30κ° λ™μ‹ λ©”μ‹μ§€ μ²λ¦¬
> - λ°©λ³„ μµλ€ 3κ° λ™μ‹ λ©”μ‹μ§€ μ²λ¦¬ (κΈ°λ³Έκ°’)
> - 5λ¶„ νƒ€μ„μ•„μ›ƒμΌλ΅ λ¬΄ν• λ€κΈ° λ°©μ§€

### 1.4 μ•μ •μ„± κΈ°λ¥ λΉ„κµ

| κµ¬λ¶„ | Domaeka μ„λ²„ | Kkobot μ„λ²„ | μƒνƒ |
|------|----------|----------|------|
| **μ¤λ¥ μ²λ¦¬** | β… κ³„μΈµμ  μ²λ¦¬ | β… κ³„μΈµμ  μ²λ¦¬ | β… λ™μΌ |
| **νƒ€μ„μ•„μ›ƒ** | β… λ‹¤μ¤‘ νƒ€μ„μ•„μ›ƒ | β… λ‹¤μ¤‘ νƒ€μ„μ•„μ›ƒ | β… λ™μΌ |
| **λ³µκµ¬ λ©”μ»¤λ‹μ¦** | β… λ©”μ‹μ§€λ³„ λ³µκµ¬ | β… λ©”μ‹μ§€λ³„ λ³µκµ¬ | β… λ™μΌ |
| **λ΅κΉ…** | κΈ°λ³Έ λ λ²¨ | μΉ΄ν…κ³ λ¦¬λ³„ μ μ–΄ | π† κ³ κΈ‰ |
| **λ¨λ‹ν„°λ§** | β… μ‹μ¤ν… λ¨λ‹ν„°λ§ | β… μ„±λ¥ ν”„λ΅νμΌλ§ | β… λ™μΌ |

> **κµ¬ν„ μ™„λ£ (2025-07-14~15)**: 
> - μ–‘μ½ μ„λ²„ λ¨λ‘ λ™μΌν• μμ¤€μ μ¤λ¥ μ²λ¦¬ λ° λ³µκµ¬ λ©”μ»¤λ‹μ¦ κµ¬ν„
> - ν•Έλ“μ…°μ΄ν¬(10μ΄), μ½κΈ°(30μ΄), λ©”μ‹μ§€ μ²λ¦¬(5λ¶„) νƒ€μ„μ•„μ›ƒ
> - μ‹μ¤ν… λ¨λ‹ν„°λ§ ν†µν•© (kb_system_monitor ν…μ΄λΈ”)

## 2. ν†µμ‹  ν”„λ΅ν† μ½ λ¶„μ„

### 2.1 Ping λ©”μ»¤λ‹μ¦ λΉ„κµ

| ν•­λ© | Domaeka μ„λ²„ | Kkobot μ„λ²„ | μƒνƒ |
|------|----------|----------|----------|
| **ping μ£ΌκΈ°** | β… 30μ΄ (ν΄λΌμ΄μ–ΈνΈλ³„) | β… 30μ΄ (ν΄λΌμ΄μ–ΈνΈλ³„) | β… λ™μΌ |
| **ping λ¶„μ‚°** | β… 0-5μ΄ λλ¤ | β… 0-5μ΄ λλ¤ | β… λ™μΌ |
| **ping λ°μ΄ν„°** | β… κΈ°λ³Έ μ •λ³΄ | β… μƒμ„Έ λ¨λ‹ν„°λ§ | β… λ™μΌ |
| **ping μ‘λ‹µ μ²λ¦¬** | β… kb_ping_monitor DB μ €μ¥ | β… kb_ping_monitor DB μ €μ¥ | β… λ™μΌ |

> **κµ¬ν„ μ™„λ£ (2025-07-15)**: Domaeka μ„λ²„μ—λ„ ν΄λΌμ΄μ–ΈνΈλ³„ λ…λ¦½ ping νƒ€μ΄λ¨Έ κµ¬ν„

### 2.2 λ©”μ‹μ§€ νλ¦„ μ•μ •μ„± (ν„μ¬ κµ¬ν„)

```mermaid
graph TD
    subgraph "κ³µν†µ λ©”μ‹μ§€ μ²λ¦¬ νλ¦„ (Domaeka & Kkobot)"
        C[ν΄λΌμ΄μ–ΈνΈ] -->|TCP| H[ν•Έλ“¤λ¬]
        H -->|ν μ¶”κ°€| Q[λ©”μ‹μ§€ ν<br/>ν¬κΈ°: 10000]
        Q --> W1[μ›μ»¤1]
        Q --> W2[μ›μ»¤2]
        Q --> W31[μ›μ»¤31]
        W1 --> BS[λ΄‡ μ„Έλ§ν¬μ–΄<br/>μµλ€ 30]
        BS --> RS[λ°© μ„Έλ§ν¬μ–΄<br/>μµλ€ 3]
        RS --> P[ν”„λ΅μ„Έμ„<br/>νƒ€μ„μ•„μ›ƒ 5λ¶„]
        P --> R[μ‘λ‹µ]
    end
```

> **κµ¬ν„ μ™„λ£**: μ–‘μ½ μ„λ²„ λ¨λ‘ λ™μΌν• μ›μ»¤ ν κΈ°λ° λ©”μ‹μ§€ μ²λ¦¬ νλ¦„ μ‚¬μ©

## 3. μ•μ •μ„± μ²΄ν¬ν¬μΈνΈ ν‰κ°€

### 3.1 μ—°κ²° μ•μ •μ„± (Connection Stability)

| μ²΄ν¬ν¬μΈνΈ | Domaeka μ„λ²„ | Kkobot μ„λ²„ | μ¤‘μ”λ„ |
|------------|-----------|-----------|--------|
| ν•Έλ“μ…°μ΄ν¬ νƒ€μ„μ•„μ›ƒ | β… 10μ΄ | β… 10μ΄ | π”΄ λ†’μ |
| μ—°κ²° μƒνƒ μ¶”μ  | β… κΈ°λ³Έ | β… κΈ°λ³Έ | β… λ™μΌ |
| μΆ€λΉ„ μ—°κ²° κ°μ§€ | β… ping + timeout | β… ping + timeout | β… λ™μΌ |
| μ¬μ—°κ²° μ§€μ› | β… ν΄λΌμ΄μ–ΈνΈ | β… ν΄λΌμ΄μ–ΈνΈ | π”΄ λ†’μ |
| IP λ³€κ²½ λ€μ‘ | β… device_id κΈ°λ° | β… device_id κΈ°λ° | π΅ μ¤‘κ°„ |

### 3.2 λ°μ΄ν„° λ¬΄κ²°μ„± (Data Integrity)

| μ²΄ν¬ν¬μΈνΈ | Domaeka μ„λ²„ | Kkobot μ„λ²„ | μ¤‘μ”λ„ |
|------------|-----------|-----------|--------|
| λ©”μ‹μ§€ μμ„ λ³΄μ¥ | β οΈ μ›μ»¤ κ²½μ | β οΈ μ›μ»¤ κ²½μ | π”΄ λ†’μ |
| λ©”μ‹μ§€ μ¤‘λ³µ λ°©μ§€ | β μ—†μ | β μ—†μ | π΅ μ¤‘κ°„ |
| λ©”μ‹μ§€ μ μ‹¤ κ°μ§€ | β οΈ ν μ¤λ²„ν”λ΅ μ‹ | β οΈ ν μ¤λ²„ν”λ΅ μ‹ | π”΄ λ†’μ |
| νΈλμ­μ… λ³΄μ¥ | β μ—†μ | β μ—†μ | πΆ λ‚®μ |

> **ν„μ¬ μƒνƒ**: μ–‘μ½ μ„λ²„ λ¨λ‘ λ™μΌν• ν•κ³„μ μ„ κ°€μ§€κ³  μμΌλ©°, μ΄λ” Phase 2μ—μ„ κ°μ„  μμ •

### 3.3 μ„±λ¥ μ•μ •μ„± (Performance Stability)

| μ²΄ν¬ν¬μΈνΈ | Domaeka μ„λ²„ | Kkobot μ„λ²„ | μ¤‘μ”λ„ |
|------------|-----------|-----------|--------|
| λ©”λ¨λ¦¬ λ„μ λ°©μ§€ | β… ν†µν•© κ΄€λ¦¬ | β… ν†µν•© κ΄€λ¦¬ | π”΄ λ†’μ |
| CPU κ³Όλ¶€ν• λ°©μ§€ | β… μ„Έλ§ν¬μ–΄ | β… μ„Έλ§ν¬μ–΄ | π”΄ λ†’μ |
| μ‘λ‹µ μ‹κ°„ μΌκ΄€μ„± | β οΈ ν λ³€λ™ | β οΈ ν λ³€λ™ | π΅ μ¤‘κ°„ |
| μ²λ¦¬λ‰ ν™•μ¥μ„± | β… μ›μ»¤ μ΅°μ • | β… μ›μ»¤ μ΅°μ • | π΅ μ¤‘κ°„ |

### 3.4 μ¤λ¥ λ³µκµ¬ (Error Recovery)

| μ²΄ν¬ν¬μΈνΈ | Domaeka μ„λ²„ | Kkobot μ„λ²„ | μ¤‘μ”λ„ |
|------------|-----------|-----------|--------|
| λ¶€λ¶„ μ‹¤ν¨ μ²λ¦¬ | β… λ©”μ‹μ§€λ³„ κ²©λ¦¬ | β… λ©”μ‹μ§€λ³„ κ²©λ¦¬ | π”΄ λ†’μ |
| μλ™ λ³µκµ¬ | β… νƒ€μ„μ•„μ›ƒ ν›„ λ³µκµ¬ | β… νƒ€μ„μ•„μ›ƒ ν›„ λ³µκµ¬ | π΅ μ¤‘κ°„ |
| μ¤λ¥ μ „ν μ°¨λ‹¨ | β… μ›μ»¤ κ²©λ¦¬ | β… μ›μ»¤ κ²©λ¦¬ | π”΄ λ†’μ |
| μƒνƒ λ³µκµ¬ | β οΈ λ¶€λ¶„μ  | β οΈ λ¶€λ¶„μ  | π΅ μ¤‘κ°„ |

> **κµ¬ν„ μ™„λ£**: μ–‘μ½ μ„λ²„ λ¨λ‘ μ›μ»¤ κΈ°λ° κ²©λ¦¬μ™€ λ©”μ‹μ§€λ³„ νƒ€μ„μ•„μ›ƒμΌλ΅ μ•μ •μ μΈ μ¤λ¥ λ³µκµ¬

## 4. λ°κ²¬λ μ·¨μ•½μ  λ° κ°μ„ μ‚¬ν•­

### 4.1 ν•΄κ²°λ μ·¨μ•½μ  (Phase 1 μ™„λ£)
1. ~~**ν•Έλ“μ…°μ΄ν¬ νƒ€μ„μ•„μ›ƒ μ—†μ**~~ β… **ν•΄κ²°λ¨** (2025-07-14)
2. ~~**λ©”μ‹μ§€ ν¬κΈ° μ ν• μ—†μ**~~ β… **ν•΄κ²°λ¨** (2025-07-15)
3. ~~**μ „μ²΄ μ—°κ²° μ μ ν• μ—†μ**~~ β… **ν•΄κ²°λ¨** (2025-07-15)
4. ~~**μλ»λ ν΄λΌμ΄μ–ΈνΈ μ¶”μ  ν‚¤**~~ β… **ν•΄κ²°λ¨** (2025-07-14)
5. ~~**λ©”λ¨λ¦¬ λ„μ μ„ν—**~~ β… **ν•΄κ²°λ¨** (2025-07-15)
6. ~~**λ™μ‹μ„± μ μ–΄ λ¶€μ΅±**~~ β… **ν•΄κ²°λ¨** (2025-07-14)

### 4.2 λ‚¨μ€ κ°μ„  κ³Όμ 
1. **λ©”μ‹μ§€ ID λ¶€μ¬**: μ¤‘λ³µ κ°μ§€ λ° μμ„ λ³΄μ¥ λ¶κ°€ β
2. **μ•”νΈν™” μ—†μ**: ν‰λ¬Έ ν†µμ‹  β
3. **μƒνƒ μ²΄ν¬ν¬μΈνΈ μ—†μ**: μ„λ²„ μ¬μ‹μ‘ μ‹ μƒνƒ μ μ‹¤ β


### 4.3 κ³ κΈ‰ μ„λ²„ κ°μ„  ν•„μ”μ‚¬ν•­ (κ²€ν†  κ²°κ³Ό)

#### β κµ¬ν„ν•μ§€ μ•λ” κ²ƒμ΄ μΆ‹μ€ κΈ°λ¥λ“¤

**1. μ›μ»¤ ν—¬μ¤μ²΄ν¬** β
```python
# μ μ•λ μ½”λ“
async def monitor_worker_health():
    # μ›μ»¤ ν™λ™ λ¨λ‹ν„°λ§ λ° μ¬μ‹μ‘
```

**κµ¬ν„ν•μ§€ μ•λ” μ΄μ **:
- **μ¤νƒμ§€ μ„ν—**: LLM API νΈμ¶ λ“± μ •μƒμ μΌλ΅ μ¤λ κ±Έλ¦¬λ” μ‘μ—…μ„ "stuck"μΌλ΅ μ¤μΈ
- **λ¶ν•„μ”ν• μ¬μ‹μ‘**: μ •μƒ μ‘λ™ μ¤‘μΈ μ›μ»¤ μ¬μ‹μ‘μΌλ΅ λ©”μ‹μ§€ μ μ‹¤ κ°€λ¥
- **ν„μ¬ λ°©μ‹μ΄ μ¶©λ¶„**: λ©”μ‹μ§€λ³„ 5λ¶„ νƒ€μ„μ•„μ›ƒμΌλ΅ κ°λ³„ λ©”μ‹μ§€ λ‹¨μ„ λ³µκµ¬ κ°€λ¥
- **λ³µμ΅λ„ λ€λΉ„ μ‹¤μµ λ¶€μ΅±**: μ‹μ¤ν… λ¶μ•μ •μ„±λ§ μ¦κ°€μ‹ν‚¬ μ„ν—

**2. μ„Έλ§ν¬μ–΄ λ°λ“λ½ λ°©μ§€** β
```python
# μ μ•λ μ½”λ“
async def acquire_with_timeout(semaphore, timeout=5):
    # μ„Έλ§ν¬μ–΄ νλ“ νƒ€μ„μ•„μ›ƒ
```

**κµ¬ν„ν•μ§€ μ•λ” μ΄μ **:
- **async withκ°€ μ΄λ―Έ μ•μ „**: Pythonμ `async with`λ” μμ™Έ μ‹μ—λ„ μλ™ ν•΄μ  λ³΄μ¥
- **νλ“ μμ„ μΌμ •**: ν•­μƒ bot_semaphore β†’ room_semaphore μμ„λ΅ λ°λ“λ½ μ„ν— μ—†μ
- **μ •μƒ λ€κΈ° μ¤‘λ‹¨ μ„ν—**: λ¶€ν•κ°€ λ†’μ„ λ• μ •μƒμ μΈ λ€κΈ°λ„ μ‹¤ν¨λ΅ μ²λ¦¬
- **μƒμ„ νƒ€μ„μ•„μ›ƒ μ΅΄μ¬**: λ©”μ‹μ§€ μ²λ¦¬ μμ²΄μ— 5λ¶„ μ ν•μ΄ μμ–΄ λ¬΄ν• λ€κΈ° λ¶κ°€

#### β… κµ¬ν„μ„ κ³ λ ¤ν•  λ§ν• κΈ°λ¥

**3. λ©”μ‹μ§€ μμ„ λ³΄μ¥** β οΈ (μ„ νƒμ )
```python
class OrderedMessageQueue:
    def __init__(self):
        self.queues = {}  # channel_id -> asyncio.Queue
```

**κµ¬ν„ μ‹ μ¥λ‹¨μ **:
- μ¥μ : μ±„λ„λ³„ λ©”μ‹μ§€ μμ„ λ³΄μ¥
- λ‹¨μ : λ³µμ΅λ„ μ¦κ°€, μ±„λ„λ³„ λ³‘λ© κ°€λ¥μ„±
- κ¶μ¥: μμ„κ°€ μ¤‘μ”ν• νΉμ • μ±„λ„μ—λ§ μ„ νƒμ  μ μ©

## 5. μƒνΈ μ μ© κ°€λ¥ν• κ°μ„ μ‚¬ν•­

### 5.1 Domaeka μ„λ²„κ°€ μ±„νƒν• Kkobot κΈ°λ¥ (κµ¬ν„ μ™„λ£)
| κΈ°λ¥ | κµ¬ν„ λ³µμ΅λ„ | ν¨κ³Ό | μƒνƒ |
|------|------------|------|----------|
| μ›μ»¤ ν (31κ°) | π΅ μ¤‘κ°„ | μ²λ¦¬λ‰ ν–¥μƒ | β… κµ¬ν„ μ™„λ£ |
| λ””λ°”μ΄μ¤ μ¶”μ  | π΅ μ¤‘κ°„ | λ³΄μ• ν–¥μƒ | β… κµ¬ν„ μ™„λ£ |
| ν•Έλ“μ…°μ΄ν¬ νƒ€μ„μ•„μ›ƒ | πΆ λ‚®μ | λ³΄μ• ν–¥μƒ | β… κµ¬ν„ μ™„λ£ |
| ping λ¨λ‹ν„°λ§ | πΆ λ‚®μ | κ°€μ‹μ„± ν–¥μƒ | β… κµ¬ν„ μ™„λ£ |
| μ„Έλ§ν¬μ–΄ λ™μ‹μ„± μ μ–΄ | πΆ λ‚®μ | DoS λ°©μ§€ | β… κµ¬ν„ μ™„λ£ |

### 5.2 Domaeka μ„λ²„ μ¶”κ°€ κµ¬ν„ κ°€λ¥ κΈ°λ¥
| κΈ°λ¥ | κµ¬ν„ λ³µμ΅λ„ | ν¨κ³Ό | μ°μ„ μμ„ |
|------|------------|------|----------|
| μ„±λ¥ νƒ€μ΄λ¨Έ | πΆ λ‚®μ | λ³‘λ© λ°κ²¬ | π΅ μ¤‘κ°„ |
| μ„¤μ • μλ™ μƒμ„± | π΅ μ¤‘κ°„ | μ΄μ νΈμμ„± | πΆ λ‚®μ |
| μƒμ„Έ λ¨λ‹ν„°λ§ | π΅ μ¤‘κ°„ | κ°€μ‹μ„± ν–¥μƒ | π΅ μ¤‘κ°„ |

### 5.3 Kkobot μ„λ²„κ°€ Domaekaμ—μ„ μ°Έκ³ ν•  κΈ°λ¥
| κΈ°λ¥ | κµ¬ν„ λ³µμ΅λ„ | ν¨κ³Ό | μ°μ„ μμ„ |
|------|------------|------|----------|
| Ping μ‹κ°„ λ¶„μ‚° | πΆ λ‚®μ | λ¶€ν• λ¶„μ‚° | π”΄ λ†’μ |
| λ‹¨μ μ¬μ‹μ‘ λ΅μ§ | πΆ λ‚®μ | λ³µκµ¬ μ‹κ°„ λ‹¨μ¶• | π΅ μ¤‘κ°„ |
| μ§μ ‘ μ²λ¦¬ μµμ… | π΅ μ¤‘κ°„ | μ €μ§€μ—° λ¨λ“ | πΆ λ‚®μ |

## 6. κ¶μ¥ ν•μ΄λΈλ¦¬λ“ μ•„ν‚¤ν…μ²

```python
class HybridServer:
    def __init__(self):
        # κ²½λ‰ λ¨λ“μ™€ κ³ κΈ‰ λ¨λ“ μ„ νƒ κ°€λ¥
        self.mode = os.getenv('SERVER_MODE', 'lightweight')
        
        # κ³µν†µ κΈ°λ¥
        self.connection_limit = asyncio.Semaphore(1000)
        self.message_id_cache = TTLCache(maxsize=10000, ttl=300)
        
        # λ¨λ“λ³„ μ΄κΈ°ν™”
        if self.mode == 'advanced':
            self.message_queue = asyncio.Queue(maxsize=10000)
            self.workers = []
            self.semaphores = {}
        
    async def handle_connection(self, reader, writer):
        async with self.connection_limit:
            # κ³µν†µ ν•Έλ“μ…°μ΄ν¬ νƒ€μ„μ•„μ›ƒ
            async with asyncio.timeout(10):
                await self.handshake(reader, writer)
            
            if self.mode == 'lightweight':
                await self.direct_processing(reader, writer)
            else:
                await self.queued_processing(reader, writer)
```

## 7. κµ¬ν„ λ΅λ“λ§µ

### Phase 1 (1μ£Όμ°¨) - κΈ΄κΈ‰ λ³΄μ• ν¨μΉ
- [x] ~~ν•Έλ“μ…°μ΄ν¬ νƒ€μ„μ•„μ›ƒ κµ¬ν„~~ β… μ™„λ£ (2025-07-14)
- [x] ~~λ©”μ‹μ§€ ν¬κΈ° μ ν•~~ β… μ™„λ£ (2025-07-15)
- [x] ~~κΈ°λ³Έ μ—°κ²° μ μ ν•~~ β… μ™„λ£ (2025-07-15)

### Phase 2 (2-3μ£Όμ°¨) - μ•μ •μ„± ν–¥μƒ
- [ ] λ©”μ‹μ§€ ID μ‹μ¤ν…
- [ ] μ¤‘λ³µ λ©”μ‹μ§€ ν•„ν„°λ§
- [ ] ν–¥μƒλ μ¤λ¥ λ΅κΉ…
- [x] ~~ν΄λΌμ΄μ–ΈνΈ μ¶”μ  κ°μ„ ~~ β… μ™„λ£ (2025-07-14)

### Phase 3 (4-6μ£Όμ°¨) - μ„±λ¥ μµμ ν™”
- [x] ~~μ›μ»¤ ν μ‹μ¤ν…~~ β… μ™„λ£ (2025-07-14)
- [ ] μ„±λ¥ λ¨λ‹ν„°λ§ λ€μ‹λ³΄λ“
- [ ] μλ™ μ¤μΌ€μΌλ§ λ΅μ§

### Phase 4 (7-8μ£Όμ°¨) - κ³ κΈ‰ κΈ°λ¥
- [ ] λ©”μ‹μ§€ μ•”νΈν™”
- [ ] μƒνƒ μ²΄ν¬ν¬μΈνΈ
- [ ] μλ™ λ³µκµ¬ μ‹μ¤ν…

## 8. κ²°λ΅  λ° κ¶μ¥μ‚¬ν•­

### 8.1 Phase 1 μ™„λ£ μ‚¬ν•­ (2025-07-14~15)
1. β… **ν•Έλ“μ…°μ΄ν¬ νƒ€μ„μ•„μ›ƒ**: 10μ΄ μ ν•μΌλ΅ μ•…μμ  μ—°κ²° μ°¨λ‹¨
2. β… **ν΄λΌμ΄μ–ΈνΈ μ¶”μ  κ°μ„ **: (bot_name, device_id) κΈ°λ°μΌλ΅ ν†µμΌ
3. β… **μ›μ»¤ ν μ‹μ¤ν…**: 31κ° μ›μ»¤λ΅ λΉ„λ™κΈ° λ©”μ‹μ§€ μ²λ¦¬
4. β… **ping λ¨λ‹ν„°λ§**: ν΄λΌμ΄μ–ΈνΈλ³„ λ…λ¦½ νƒ€μ΄λ¨Έ λ° DB μ €μ¥
5. β… **μ„Έλ§ν¬μ–΄ λ™μ‹μ„± μ μ–΄**: λ΄‡λ³„(30)/λ°©λ³„(3) μ²λ¦¬λ‰ μ ν•
6. β… **λ©”μ‹μ§€ ν¬κΈ° μ ν•**: TCP(1MB) λ° μΉ΄μΉ΄μ¤ν†΅(65,000μ) μ ν•
7. β… **μ „μ²΄ μ—°κ²° μ μ ν•**: μµλ€ 100κ° λ™μ‹ μ—°κ²°λ΅ DoS λ°©μ–΄
8. β… **μ‹μ¤ν… λ¨λ‹ν„°λ§**: 5λ¶„λ§λ‹¤ λ¦¬μ†μ¤ μ‚¬μ©λ¥  DB μ €μ¥
9. β… **λ©”λ¨λ¦¬ κ΄€λ¦¬**: μ£ΌκΈ°μ  GC λ° μ¤λλ λ°μ΄ν„° μ •λ¦¬

### 8.2 λ‹¨κΈ° κ°μ„  κ³Όμ  (Phase 2)
1. **λ©”μ‹μ§€ ID μ‹μ¤ν…**: μ¤‘λ³µ λ°©μ§€ λ° μμ„ λ³΄μ¥
2. **ν–¥μƒλ μ¤λ¥ λ΅κΉ…**: κµ¬μ΅°ν™”λ λ΅κ·Έ λ° μ¶”μ  ID

### 8.3 μ¥κΈ° κ°μ„  (3κ°μ›” λ‚΄)
1. ν•μ΄λΈλ¦¬λ“ μ•„ν‚¤ν…μ² κµ¬ν„
2. ν†µν•© λ¨λ‹ν„°λ§ μ‹μ¤ν…
3. μλ™ λ³µκµ¬ λ©”μ»¤λ‹μ¦

## 9. κµ¬ν„ μ™„λ£ μ‚¬ν•­ μ΄μ •λ¦¬

### 9.1 Phase 1 λ³΄μ• κ°•ν™” (2025-07-14~15 μ™„λ£)

#### π” μ—°κ²° λ° μΈμ¦
| ν•­λ© | κµ¬ν„ λ‚΄μ© | ν¨κ³Ό |
|------|----------|------|
| **ν•Έλ“μ…°μ΄ν¬ νƒ€μ„μ•„μ›ƒ** | 10μ΄ μ ν• | μ•…μμ  μ—°κ²° μ°¨λ‹¨ |
| **μ „μ²΄ μ—°κ²° μ μ ν•** | μµλ€ 100κ° λ™μ‹ μ—°κ²° | DoS κ³µκ²© λ°©μ–΄ |
| **ν΄λΌμ΄μ–ΈνΈ μ¶”μ ** | (bot_name, device_id) λ³µν•©ν‚¤ | λ¨λ°”μΌ ν™κ²½ λ€μ‘ |
| **λ””λ°”μ΄μ¤ μΉμΈ** | kb_bot_devices ν…μ΄λΈ” μ—°λ™ | λ¬΄λ‹¨ μ ‘μ† μ°¨λ‹¨ |

#### π“ ν¬κΈ° λ° μ²λ¦¬ μ ν•
| ν•­λ© | κµ¬ν„ λ‚΄μ© | ν¨κ³Ό |
|------|----------|------|
| **TCP λ©”μ‹μ§€ ν¬κΈ°** | μµλ€ 1MB | λ©”λ¨λ¦¬ κ³µκ²© λ°©μ§€ |
| **μΉ΄μΉ΄μ¤ν†΅ λ©”μ‹μ§€** | μµλ€ 65,000μ | μ „μ†΅ μ•μ •μ„± |
| **λ΄‡λ³„ λ™μ‹ μ²λ¦¬** | μµλ€ 30κ° | κ³Όλ¶€ν• λ°©μ§€ |
| **λ°©λ³„ λ™μ‹ μ²λ¦¬** | μµλ€ 3κ° | κ³µμ •ν• μ²λ¦¬ |

#### β±οΈ νƒ€μ„μ•„μ›ƒ μ²΄κ³„
| λ‹¨κ³„ | μ‹κ°„ | λ©μ  |
|------|------|------|
| **ν•Έλ“μ…°μ΄ν¬** | 10μ΄ | λΉ λ¥Έ μ—°κ²° ν™•μΈ |
| **λ©”μ‹μ§€ μ½κΈ°** | 30μ΄ | μΆ€λΉ„ μ—°κ²° κ°μ§€ |
| **λ©”μ‹μ§€ μ²λ¦¬** | 5λ¶„ | λ¬΄ν• λ€κΈ° λ°©μ§€ |

### 9.2 μ„±λ¥ λ° μ•μ •μ„± κ°μ„ 

#### π€ λΉ„λ™κΈ° μ²λ¦¬
- **μ›μ»¤ ν μ‹μ¤ν…**: 31κ° μ›μ»¤λ΅ λ³‘λ ¬ μ²λ¦¬
- **λ©”μ‹μ§€ ν**: μµλ€ 10,000κ° λ€κΈ° κ°€λ¥
- **μ„Έλ§ν¬μ–΄ μ μ–΄**: λ΄‡λ³„/λ°©λ³„ λ™μ‹μ„± κ΄€λ¦¬

#### π’Ύ λ©”λ¨λ¦¬ κ΄€λ¦¬
- **μ£ΌκΈ°μ  GC**: 10λ¶„λ§λ‹¤ κ°•μ  κ°€λΉ„μ§€ μ»¬λ ‰μ…
- **λ©”λ¨λ¦¬ λ¨λ‹ν„°λ§**: 80% κ²½κ³ , 90% κΈ΄κΈ‰ μ •λ¦¬
- **μ¤λλ λ°μ΄ν„° μ •λ¦¬**: 30λ¶„λ§λ‹¤ μλ™ μ‹¤ν–‰
- **μν™ μ°Έμ΅° λ°©μ§€**: writer κ°μ²΄ μ§μ ‘ μ°Έμ΅° μ κ±°

#### π“ λ¨λ‹ν„°λ§
- **μ‹μ¤ν… λ¨λ‹ν„°λ§**: 5λ¶„λ§λ‹¤ CPU/λ©”λ¨λ¦¬/λ””μ¤ν¬ μ‚¬μ©λ¥  DB μ €μ¥
- **Ping μ‹μ¤ν…**: ν΄λΌμ΄μ–ΈνΈλ³„ 30μ΄ μ£ΌκΈ° λ…λ¦½ νƒ€μ΄λ¨Έ
- **μ—°κ²° μƒνƒ μ¶”μ **: kb_ping_monitor ν…μ΄λΈ” ν™μ©

### 9.3 ν„μ¬ μ‹μ¤ν… μƒνƒ

**β… μ–‘μ½ μ„λ²„ κ³µν†µ κµ¬ν„ μ™„λ£**:
- λ™μΌν• λ³΄μ• μμ¤€
- λ™μΌν• μ„±λ¥ μµμ ν™”
- λ™μΌν• μ•μ •μ„± λ©”μ»¤λ‹μ¦

**π“ μλ„μ  μ°¨μ΄μ  (μ μ§€)**:
- μ„¤μ • κ΄€λ¦¬: Kkobot μλ™, Domaeka μλ™
- λ΅κΉ… μƒμ„Έλ„: Kkobotμ΄ λ” μ„Έλ°€ν• μ μ–΄
- ν”„λ΅μ νΈλ³„ νΉν™” κΈ°λ¥

### 2025-07-14 μ¶”κ°€ κµ¬ν„: μ‹μ¤ν… λ¨λ‹ν„°λ§

**kb_system_monitor ν…μ΄λΈ” κΈ°λ° μ‹μ¤ν… λ¨λ‹ν„°λ§ κµ¬ν„**:
- μ–‘μ½ μ„λ²„ λ¨λ‘ 5λ¶„λ§λ‹¤ μ‹μ¤ν… μƒνƒλ¥Ό DBμ— μ €μ¥
- CPU, λ©”λ¨λ¦¬, λ””μ¤ν¬ μ‚¬μ©λ¥  μ¶”μ 
- ν™μ„± μ—°κ²° μ λ° λ©”μ‹μ§€ ν ν¬κΈ° λ¨λ‹ν„°λ§
- μ„λ²„λ³„λ΅ λ…λ¦½μ μΈ λ°μ΄ν„° μμ§‘ (server_nameμΌλ΅ κµ¬λ¶„)

μ΄λ΅μ¨ λ¦¬μ†μ¤ λ¨λ‹ν„°λ§ μΈ΅λ©΄μ—μ„λ„ λ‘ μ„λ²„κ°€ λ™μΌν• μμ¤€μ κΈ°λ¥μ„ μ κ³µν•κ² λμ—μµλ‹λ‹¤.

### 2025-07-15 μ¶”κ°€ κµ¬ν„: ν΄λΌμ΄μ–ΈνΈλ³„ Ping νƒ€μ΄λ¨Έ

**Domaeka μ„λ²„ Ping μ‹μ¤ν… κ°μ„ **:
- κΈ°μ΅΄ λ©”μ‹μ§€ μΉ΄μ΄ν„° κΈ°λ°μ—μ„ ν΄λΌμ΄μ–ΈνΈλ³„ λ…λ¦½ νƒ€μ΄λ¨Έλ΅ λ³€κ²½
- κ° ν΄λΌμ΄μ–ΈνΈλ§λ‹¤ 30μ΄ μ£ΌκΈ°μ λ…λ¦½μ μΈ ping νƒμ¤ν¬ μ‹¤ν–‰
- 0-5μ΄ λλ¤ μ΄κΈ° μ§€μ—°μΌλ΅ μ„λ²„ λ¶€ν• λ¶„μ‚°
- ν΄λΌμ΄μ–ΈνΈ μ—°κ²°/ν•΄μ  μ‹ μλ™μΌλ΅ ping νƒμ¤ν¬ κ΄€λ¦¬

μ΄μ  μ–‘μ½ μ„λ²„ λ¨λ‘ λ™μΌν• ν΄λΌμ΄μ–ΈνΈλ³„ ping νƒ€μ΄λ¨Έ μ‹μ¤ν…μ„ μ‚¬μ©ν•©λ‹λ‹¤.

### 2025-07-15 μ¶”κ°€ κµ¬ν„: λ©”λ¨λ¦¬ λ„μ λ°©μ§€

**μ–‘μ½ μ„λ²„ λ©”λ¨λ¦¬ κ΄€λ¦¬ ν†µν•© κµ¬ν„**:
1. **μ£ΌκΈ°μ  κ°€λΉ„μ§€ μ»¬λ ‰μ…**: 10λ¶„λ§λ‹¤ κ°•μ  GC μ‹¤ν–‰μΌλ΅ μ°Έμ΅°λμ§€ μ•λ” κ°μ²΄ μ •λ¦¬
2. **λ©”λ¨λ¦¬ μ‚¬μ©λ¥  λ¨λ‹ν„°λ§**: 5λ¶„λ§λ‹¤ μ‹μ¤ν…/ν”„λ΅μ„Έμ¤ λ©”λ¨λ¦¬ μƒνƒ μ²΄ν¬
   - 80% μ΄μƒ: κ²½κ³  λ΅κ·Έ
   - 90% μ΄μƒ: κΈ΄κΈ‰ λ©”λ¨λ¦¬ μ •λ¦¬ μ‹¤ν–‰
3. **μ¤λλ λ°μ΄ν„° μλ™ μ •λ¦¬**: 30λ¶„λ§λ‹¤ μ‹¤ν–‰
   - 1μ‹κ°„ μ΄μƒ λΉ„ν™μ„± ν΄λΌμ΄μ–ΈνΈ μƒνƒ μ κ±°
   - λ‹«ν writer κ°μ²΄ μ •λ¦¬
   - λ§λ£λ λ€ν™” μ°Έμ—¬ λΈ”λ΅ μ κ±° (Kkobot only)
4. **μν™ μ°Έμ΅° λ°©μ§€**: 
   - λ©”μ‹μ§€μ— writer κ°μ²΄ μ§μ ‘ ν¬ν•¨ μ κ±°
   - client_key (bot_name, device_id) νν”λ΅ writer μ΅°νν•λ„λ΅ λ³€κ²½

μ΄λ΅μ¨ λ‘ μ„λ²„ λ¨λ‘ λ™μΌν• μμ¤€μ λ©”λ¨λ¦¬ κ΄€λ¦¬ κΈ°λ¥μ„ κ°–μ¶”κ² λμ—μµλ‹λ‹¤.

### 2025-07-15 μ¶”κ°€ κµ¬ν„: λ©”μ‹μ§€ ν¬κΈ° μ ν•

**μ–‘μ½ μ„λ²„ λ©”μ‹μ§€ ν¬κΈ° μ ν• μ™„μ „ κµ¬ν„**:
1. **TCP λ λ²¨ μ ν•**: 
   - MAX_MESSAGE_SIZE = 1MBλ΅ μ›μ‹ TCP λ°μ΄ν„° μ ν•
   - StreamReaderμ limit μ„¤μ •μΌλ΅ λ²„νΌ μ¤λ²„ν”λ΅ λ°©μ§€
   - readuntil() μ‚¬μ©μΌλ΅ ν¬κΈ° μ΄κ³Ό μ‹ μ¦‰μ‹ κ°μ§€

2. **μ• ν”λ¦¬μΌ€μ΄μ… λ λ²¨ μ ν•**:
   - MAX_KAKAOTALK_MESSAGE_LENGTH = 65,000μλ΅ μΉ΄μΉ΄μ¤ν†΅ λ©”μ‹μ§€ μ ν•
   - μμ‹  λ©”μ‹μ§€ κΈΈμ΄ μ²΄ν¬ λ° κ²½κ³ /λ¬΄μ‹ μ²λ¦¬
   - μ‘λ‹µ λ©”μ‹μ§€ μλ™ μλΌλ‚΄κΈ°λ΅ μ „μ†΅ μ‹¤ν¨ λ°©μ§€

3. **λ³΄μ• κ°•ν™” ν¨κ³Ό**:
   - λ©”λ¨λ¦¬ κ³µκ²© μ°¨λ‹¨: κ±°λ€ν• λ©”μ‹μ§€λ΅ μΈν• λ©”λ¨λ¦¬ κ³ κ° λ°©μ§€
   - DoS κ³µκ²© μ™„ν™”: λ€μ©λ‰ λ°μ΄ν„° μ „μ†΅μΌλ΅ μΈν• μ„λ²„ λ¶€ν• μ°¨λ‹¨
   - μ•μ •μ μΈ ν†µμ‹ : μΉ΄μΉ΄μ¤ν†΅ μ ν• μ¤€μλ΅ λ©”μ‹μ§€ μ „λ‹¬ λ³΄μ¥

μ΄λ΅μ¨ λ©”μ‹μ§€ ν¬κΈ° μ ν• κ΄€λ ¨ λ³΄μ• μ·¨μ•½μ μ΄ μ™„μ „ν ν•΄κ²°λμ—μµλ‹λ‹¤.

### 2025-07-15 μ¶”κ°€ κµ¬ν„: μ „μ²΄ μ—°κ²° μ μ ν•

**μ–‘μ½ μ„λ²„ μ „μ²΄ μ—°κ²° μ μ ν• κµ¬ν„**:
1. **μ „μ—­ μ„¤μ •**:
   - MAX_CONCURRENT_CONNECTIONS = 100 (κΈ°λ³Έκ°’)
   - connection_semaphoreλ΅ μ „μ²΄ TCP μ—°κ²° μ κ΄€λ¦¬

2. **κµ¬ν„ λ‚΄μ©**:
   - μ„λ²„ μ‹μ‘ μ‹ μ„Έλ§ν¬μ–΄ μ΄κΈ°ν™”
   - μƒ μ—°κ²° μ‹λ„ μ‹ μ„Έλ§ν¬μ–΄ νλ“
   - μ—°κ²° μ μ΄κ³Ό μ‹ μ¦‰μ‹ μ—°κ²° κ±°λ¶€
   - μ—°κ²° μΆ…λ£ μ‹ μ„Έλ§ν¬μ–΄ ν•΄μ 

3. **λ³΄μ• ν¨κ³Ό**:
   - DoS κ³µκ²© λ°©μ§€: λ¬΄ν• μ—°κ²° μ‹λ„ μ°¨λ‹¨
   - λ¦¬μ†μ¤ λ³΄νΈ: νμΌ λ””μ¤ν¬λ¦½ν„° λ° λ©”λ¨λ¦¬ κ³ κ° λ°©μ§€
   - μ„λ²„ μ•μ •μ„±: κ³Όλ¶€ν• μƒν™©μ—μ„λ„ μ•μ •μ  μ΄μ

4. **λ΅κΉ… κ°μ„ **:
   - μ—°κ²° μ‹ ν™μ„± μ—°κ²° μ ν‘μ‹
   - μ—°κ²° ν•΄μ  μ‹ λ‚¨μ€ μ—°κ²° μ ν‘μ‹

μ΄λ΅μ¨ Phase 1μ λ¨λ“  κΈ΄κΈ‰ λ³΄μ• ν¨μΉκ°€ μ™„λ£λμ—μµλ‹λ‹¤.

## 10. κµ¬ν„ κ²€ν†  κ²°κ³Ό λ° κ¶μ¥μ‚¬ν•­

### 10.1 κµ¬ν„ν•μ§€ μ•κΈ°λ΅ κ²°μ •ν• κΈ°λ¥λ“¤

λ¬Έμ„μ—μ„ μ μ•λ μΌλ¶€ "κ³ κΈ‰ κΈ°λ¥"λ“¤μ€ κ²€ν†  κ²°κ³Ό, ν„μ¬ μ‹μ¤ν…μ—μ„λ” μ¤νλ ¤ ν•΄κ°€ λ  μ μμ–΄ κµ¬ν„ν•μ§€ μ•κΈ°λ΅ κ²°μ •ν–μµλ‹λ‹¤:

1. **μ›μ»¤ ν—¬μ¤μ²΄ν¬**: 
   - ν„μ¬μ λ©”μ‹μ§€λ³„ νƒ€μ„μ•„μ›ƒ(5λ¶„)μ΄ λ” μ•μ „ν•κ³  ν¨κ³Όμ 
   - μ›μ»¤ μ¬μ‹μ‘μ€ μ¤νλ ¤ λ©”μ‹μ§€ μ μ‹¤κ³Ό μ‹μ¤ν… λ¶μ•μ •μ„± μ λ°

2. **μ„Έλ§ν¬μ–΄ λ°λ“λ½ λ°©μ§€**:
   - Pythonμ `async with`κ°€ μ΄λ―Έ μ•μ „ν• ν•΄μ  λ³΄μ¥
   - νƒ€μ„μ•„μ›ƒ μ¶”κ°€λ” μ •μƒμ μΈ λ€κΈ° μƒν™©μ„ μ¤λ¥λ΅ μ²λ¦¬ν•  μ„ν—

### 10.2 ν„μ¬ μ‹μ¤ν…μ κ°•μ 

ν„μ¬ κµ¬ν„λ μ‹μ¤ν…μ€ μ΄λ―Έ μ¶©λ¶„ν μ•μ •μ μ΄κ³  ν¨μ¨μ μ…λ‹λ‹¤:
- **λ‹¤μΈµ λ³΄νΈ**: TCP μ—°κ²° β†’ λ©”μ‹μ§€ ν¬κΈ° β†’ λ™μ‹μ„± μ μ–΄ β†’ νƒ€μ„μ•„μ›ƒ
- **μλ™ λ³µκµ¬**: λ¬Έμ  λ°μƒ μ‹ κ°λ³„ λ©”μ‹μ§€ λ‹¨μ„λ΅ κ²©λ¦¬λμ–΄ μ „μ²΄ μ‹μ¤ν… μν–¥ μµμ†ν™”
- **λ‹¨μμ„±**: λ³µμ΅ν• λ¨λ‹ν„°λ§/μ¬μ‹μ‘ λ΅μ§ μ—†μ΄λ„ μ•μ •μ  μ΄μ

"λ” λ³µμ΅ν• κ²ƒμ΄ ν•­μƒ λ” μΆ‹μ€ κ²ƒμ€ μ•„λ‹λ‹¤" - ν„μ¬μ λ‹¨μν•κ³  κ²¬κ³ ν• κµ¬μ΅°κ°€ μ¤νλ ¤ μ¥μ μ…λ‹λ‹¤.