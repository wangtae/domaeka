# Domaeka 프로젝트 규칙 (Project Rules)

이 문서는 Domaeka 프로젝트의 주요 개선 사항인 계층형 관리자 구조 구현을 위한 핵심 개발 원칙과 가이드라인을 정의합니다. 모든 개발자는 이 규칙을 준수하여 프로젝트의 품질과 유지보수성을 확보해야 합니다.

## 1. 계층형 관리자 구조 구현 원칙

기존 영카트5(그누보드5)의 관리자 시스템을 **본사 - 대리점 - 지점**으로 구분되는 다단계 계층 구조로 확장합니다. 이 구조는 각 계층별로 명확한 권한과 접근 범위를 가지도록 설계되어야 합니다.

### 1.1. 계층 정의 및 관리

*   **계층 구분**: 본사(최상위 관리자), 대리점(특정 대리점 산하의 지점 및 사용자 관리), 지점(특정 지점 산하의 사용자 및 주문 관리)으로 구분합니다.
*   **데이터 모델 확장**: 기존 회원 또는 관리자 관련 데이터베이스 테이블에 새로운 계층 정보를 저장할 필드(예: `mb_level_type` 또는 별도의 `admin_hierarchy` 테이블)를 추가하거나 연동 방안을 모색합니다.
*   **계층 관계 정의**: 각 대리점이 어떤 지점을 관리하는지, 각 지점이 어떤 사용자와 주문에 접근할 수 있는지 등 계층 간의 상하 관계를 명확히 정의하고 데이터베이스 스키마에 반영합니다.
*   **메인 및 서브 관리자**: 각 계층(본사, 대리점, 지점) 내에는 하나의 메인 관리자(`main`)와 여러 명의 서브 관리자(`sub`)를 생성할 수 있습니다.

### 1.2. 권한 및 접근 제어

*   **세분화된 권한**: 각 계층별로 접근 가능한 관리자 메뉴, CRUD(생성, 읽기, 업데이트, 삭제) 권한, 데이터 조회 범위 등을 상세하게 정의하고 적용합니다.
*   **기존 권한 시스템 확장**: 그누보드5의 기존 권한 관리 시스템(`auth.php` 등)을 최대한 활용하되, 계층 구조에 따른 추가적인 권한 검증 로직을 구현합니다.
*   **데이터 가시성 제한**: 대리점 관리자는 자신의 산하 지점 및 해당 지점의 매출 현황과 통계를 확인할 수 있도록, 지점 관리자는 자신의 지점 관련 데이터(상품, 주문 내역 등)만 볼 수 있도록 데이터 조회 범위를 철저히 제한합니다. 본사 관리자는 모든 대리점과 지점의 모든 현황을 파악할 수 있어야 합니다.
*   **서브 관리자 권한 배정**: `sub` 관리자는 기본적으로 아무런 권한이 없으며, `main` 관리자가 명시적으로 권한을 배정해 주는 기능들만 사용할 수 있도록 설계합니다.
*   **보안 강화**: 권한 우회나 데이터 유출을 방지하기 위해 모든 관리자 액션에 대한 권한 검증을 철저히 합니다.

### 1.3. UI/UX 개선

*   **계층 표시**: 관리자 페이지에서 현재 로그인한 관리자의 계층 정보 및 접근 가능한 범위를 명확히 표시합니다.
*   **필터링/검색**: 각 계층 관리자가 자신의 범위 내에서만 데이터를 조회하고 필터링할 수 있도록 UI를 개선합니다.

## 2. 기존 영카트/그누보드 파일 수정 최소화 원칙 (Open/Closed Principle)

새로운 계층형 관리자 구조를 구현할 때, 기존 영카트5(그누보드5)의 핵심 파일을 최대한 수정하지 않는 것을 최우선 원칙으로 삼습니다. 이는 시스템의 안정성을 유지하고, 향후 그누보드/영카트 업데이트 시 발생할 수 있는 충돌을 최소화하며, 유지보수성을 높이는 데 필수적입니다.

### 2.1. 확장 지향 개발

*   **후크(Hook) 및 이벤트 활용**: 그누보드/영카트가 제공하는 후크(예: `hook.class.php`, `hook.extends.class.php`) 또는 이벤트 시스템을 적극 활용하여 기존 코드를 수정하지 않고 기능을 확장합니다.
*   **오버라이딩 최소화**: 부득이하게 기존 파일을 수정해야 하는 경우, 해당 파일의 특정 기능만 오버라이딩하거나 확장할 수 있는 방법을 모색합니다. 파일 전체를 복사하여 수정하는 방식은 지양합니다.
*   **새로운 모듈/클래스 생성**: 새로운 기능은 독립적인 모듈, 클래스, 함수로 분리하여 추가합니다. 예를 들어, `main/adm/` 폴더 내에 `admin_hierarchy/`와 같은 별도의 서브 폴더를 생성하여 관련 로직을 집중 관리합니다.
*   **설정 기반 제어**: 새로운 기능의 활성화/비활성화, 동작 방식 등을 `main/shop.config.php` 또는 별도의 설정 파일에서 제어할 수 있도록 설계하여 유연성을 확보합니다.

### 2.2. 추상화 및 인터페이스 활용

*   **인터페이스 정의**: 계층형 관리자 권한과 관련된 로직을 추상화하고, 명확한 인터페이스를 정의하여 구체적인 구현체가 인터페이스에 의존하도록 설계합니다.
*   **의존성 주입 (Dependency Injection)**: 필요한 경우 의존성 주입 패턴을 사용하여 모듈 간의 결합도를 낮추고 테스트 용이성을 높입니다.

### 2.3. 데이터베이스 변경 관리

*   **기존 테이블 보호**: 기존 영카트/그누보드의 핵심 테이블(`g5_member` 등)은 절대 삭제하거나 구조를 파괴적으로 변경하지 않습니다.
*   **새로운 테이블 추가**: 계층형 관리자 구조에 필요한 새로운 데이터(예: 대리점/지점 정보, 계층별 권한 매핑)는 기존 테이블에 컬럼을 추가하거나, **새로운 테이블을 생성하여 관리**합니다.
*   **마이그레이션 스크립트**: 데이터베이스 스키마 변경 시에는 반드시 안전한 마이그레이션 스크립트와 롤백 스크립트를 함께 작성하고, `migrate:fresh`, `migrate:reset`과 같은 파괴적인 명령은 운영 환경에서 절대 사용하지 않습니다.

## 3. 지점별 주문 페이지 및 상품 관리

각 지점은 고유한 주문 페이지를 가지며, 해당 페이지를 통해 등록된 상품을 판매하고 주문 내역을 관리할 수 있어야 합니다.

### 3.1. 지점별 주문 페이지 (프론트엔드)

*   **고유 URL**: 각 지점은 `도메인/지점ID`와 같은 형태로 고유한 주문 URL을 가집니다. 이를 통해 해당 지점의 상품만 노출되고 주문이 접수됩니다.
*   **KakaoTalk 로그인 기반 주문**: 사용자 편의를 위해 카카오톡 로그인을 기반으로 주문이 이루어지도록 구현합니다. 지점 주문 페이지에서 주문 시 해당 주문의 매출은 해당 지사(지점)의 매출로 자동 집계되도록 합니다. (기존 영카트 회원 시스템과의 연동 방식 고려)
*   **상품 목록 및 상세**: 지점별로 등록된 상품 목록을 보여주고, 상품 상세 정보, 수량 선택, 장바구니/주문하기 기능을 제공합니다.
*   **주문 정보 입력**: 고객명, 전화번호, 요청사항 등 주문에 필요한 필수 정보를 입력받습니다. (예시 HTML 페이지 참고)
*   **재고 관리**: 상품 재고가 소진될 경우, 주문 불가 처리 및 사용자에게 알림을 제공합니다.

### 3.2. 지점별 상품 및 주문 관리 (관리자 시스템)

*   **`adm/shop_admin/` 활용**: 기존 영카트 쇼핑몰 관리자 모듈(`main/adm/shop_admin/`)을 확장하여 지점별 상품 및 주문 관리가 가능하도록 합니다.
*   **상품 등록 및 수정**: 각 계층(본사, 대리점, 지점)의 관리자는 자신이 속한 계층에서 상품을 등록할 수 있습니다. 지점 관리자는 자신이 관리하는 지점의 상품만 등록, 수정, 삭제할 수 있습니다. 본사 및 대리점 관리자는 전체 상품을 관리할 수 있습니다.
*   **상위 계층 상품 보관/노출**: 대리점 또는 지점은 상위 계층(본사 또는 대리점)에서 등록된 상품을 자신의 주문 페이지에 노출시키기 위해 "보관(가져오기)" 처리할 수 있는 기능을 제공합니다.
*   **주문 내역 조회 및 처리**: 각 지점 관리자는 자신의 지점에서 발생한 주문 내역만 조회하고, 주문 상태 변경, 배송 정보 입력 등의 처리를 할 수 있습니다. 본사 관리자는 전체 주문 내역을 조회할 수 있습니다.
*   **재고 현황 파악**: 각 지점별로 등록된 상품들의 재고 현황을 파악할 수 있는 기능을 제공하여 효율적인 재고 관리가 가능하도록 합니다.
*   **계층별 데이터 필터링**: 관리자 페이지에서 데이터를 조회할 때, 로그인한 관리자의 계층에 따라 자동으로 데이터가 필터링되도록 로직을 구현합니다.

## 4. 개발 프로세스 및 품질

*   **설계 우선**: 개발 시작 전 항상 상세 의사코드(pseudocode)를 작성하고, 계층형 관리자 구조의 데이터 흐름과 권한 검증 로직을 명확히 설계한 후 개발을 진행합니다.
*   **단일 책임 원칙**: 각 모듈, 함수, 클래스는 하나의 명확한 책임만을 가지도록 유지합니다.
*   **테스트 가능성**: 모든 코드는 단위 테스트가 가능한 구조로 작성하며, 특히 권한 검증 로직은 철저한 테스트를 통해 예상치 못한 접근을 방지합니다.
*   **문서화**: 새로운 계층 구조 및 권한 로직에 대한 상세한 문서화(설계 문서, API 명세, 코드 주석 등)를 필수적으로 수행합니다.
*   **코드 리뷰**: 모든 변경 사항은 코드 리뷰를 통해 기존 시스템에 미치는 영향과 이 문서에 정의된 규칙 준수 여부를 철저히 검토합니다.

이 문서에 명시된 규칙들은 Domaeka 프로젝트의 성공적인 개선을 위한 핵심 지침이 될 것입니다. 