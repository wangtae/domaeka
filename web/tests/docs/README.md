# ë„ë§¤ê¹Œ ì›¹ ê´€ë¦¬í˜ì´ì§€ ìë™í™” í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

## ê°œìš”

ë„ë§¤ê¹Œ(Domaeka) ì›¹ ê´€ë¦¬í˜ì´ì§€ëŠ” ì˜ì¹´íŠ¸5 ê¸°ë°˜ì˜ 4ê³„ì¸µ í”„ëœì°¨ì´ì¦ˆ ê´€ë¦¬ ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ë³¸ ë¬¸ì„œëŠ” Playwrightë¥¼ í™œìš©í•œ ìë™í™” í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

### í…ŒìŠ¤íŠ¸ í™˜ê²½
- **URL**: http://domaeka.local/adm
- **ìµœê³ ê´€ë¦¬ì**: admin / !domaekaservice@.
- **ê¸°ë°˜ ì‹œìŠ¤í…œ**: ì˜ì¹´íŠ¸5 + ë„ë§¤ê¹Œ í™•ì¥

### ê´€ë¦¬ ê³„ì¸µ êµ¬ì¡°
```
ë³¸ì‚¬ (headquarters)
  â””â”€ ì´íŒ (distributor)
      â””â”€ ëŒ€ë¦¬ì  (agency)
          â””â”€ ì§€ì  (branch)
```

### ê´€ë¦¬ì íƒ€ì…
- **main**: ìµœê³ ê´€ë¦¬ì - í•´ë‹¹ ê³„ì¸µì˜ ëª¨ë“  ê¶Œí•œ ë³´ìœ 
- **sub**: ì„œë¸Œê´€ë¦¬ì - ìµœê³ ê´€ë¦¬ìê°€ ë¶€ì—¬í•œ ê¶Œí•œ(g5_auth)ë§Œ ì‚¬ìš© ê°€ëŠ¥

### ê¶Œí•œ ì›ì¹™
1. ê° ê³„ì¸µì€ ìì‹ ê³¼ í•˜ìœ„ ê³„ì¸µì˜ ì •ë³´ë§Œ ì—´ëŒ/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
2. ìƒìœ„ ê³„ì¸µ ì •ë³´ëŠ” ì ‘ê·¼ ë¶ˆê°€
3. ë™ì¼ ê³„ì¸µì˜ ë‹¤ë¥¸ ì¡°ì§ ì •ë³´ëŠ” ì ‘ê·¼ ë¶ˆê°€

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì„±

### 1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
ê° ë©”ë‰´ë³„ë¡œ ë…ë¦½ì ì¸ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ë¬¸ì„œë¥¼ ì‘ì„±í•˜ì—¬ ê´€ë¦¬í•©ë‹ˆë‹¤.
ë©”ë‰´ë³„ë¡œ ë³¸ì‚¬-ì´íŒ-ëŒ€ë¦¬ì -ì§€ì  ê´€ë¦¬ìë¡œ ê°ê° ë¡œê·¸ì¸í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ì‹¤íŒ¨ì‹œ ì „ì²´ë¥¼ ì¤‘ë‹¨í•´ì„œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ë‹¤ì‹œ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
mysql mcpë¥¼ í™œìš©í•˜ì—¬ db í…Œì´ë¸” êµ¬ì¡°ì™€ ì…ë ¥ë˜ì–´ ìˆëŠ” ë°ì´í„°ë¥¼ ì°¸ê³ í•´ì•¼ í•©ë‹ˆë‹¤.

ì„œë¸Œ ê´€ë¦¬ì ê¶Œí•œ ì²´í¬ëŠ” ë©”ì¸ ê´€ë¦¬ì í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ë©´ í…ŒìŠ¤íŠ¸ë¥¼ êµ¬í˜„í•˜ì—¬ ì§„í–‰í•©ë‹ˆë‹¤. (ì•„ì§ì€ ì§„í–‰ ì•ˆí•¨)

#### ê¸°ë³¸ ë°ì´í„°
- ì´íŒ(dmk_distributor)
  - domaeka : ì‹¤ì œ ìš´ì˜ì¤‘ì¸ ì´íŒìœ¼ë¡œ ì´ ì´íŒì€ í…ŒìŠ¤íŠ¸ì— ì´ìš©í•˜ë©´ ì•ˆë©ë‹ˆë‹¤.
  - distributor : í…ŒìŠ¤íŠ¸ ì „ì— ë¯¸ë¦¬ ìƒì„±ë˜ì–´ ìˆëŠ” ì´íŒ ì•„ì´ë””ì…ë‹ˆë‹¤.
  - d_test_01 : í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ì´íŒ ì•„ì´ë””ë¥¼ ìƒˆë¡œ ìƒì„±í• ë•Œ ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤. (ì´íŒ-ëŒ€ë¦¬ì -ì§€ì  ë“±ë¡/ìˆ˜ì • ë“±ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•¨)

- ëŒ€ë¦¬ì (dmk_agency)
  - domaeka1 : ì‹¤ì œ ìš´ì˜ì¤‘ì¸ ëŒ€ë¦¬ì ìœ¼ë¡œ ì´ ëŒ€ë¦¬ì ì€ í…ŒìŠ¤íŠ¸ì— ì´ìš©í•˜ë©´ ì•ˆë©ë‹ˆë‹¤.
  - agency001 : í…ŒìŠ¤íŠ¸ ì „ì— ë¯¸ë¦¬ ìƒì„±ë˜ì–´ ìˆëŠ” ëŒ€ë¦¬ì  ì•„ì´ë””ì…ë‹ˆë‹¤.
  - a_test_01 : í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ëŒ€ë¦¬ì  ì•„ì´ë””ë¥¼ ìƒˆë¡œ ìƒì„±í• ë•Œ ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤. (ì´íŒ-ëŒ€ë¦¬ì -ì§€ì  ë“±ë¡/ìˆ˜ì • ë“±ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•¨)

- ëŒ€ë¦¬ì (dmk_agency)
  - domaeka11 : ì‹¤ì œ ìš´ì˜ì¤‘ì¸ ì§€ì ìœ¼ë¡œ ì´ ì§€ì ì€ í…ŒìŠ¤íŠ¸ì— ì´ìš©í•˜ë©´ ì•ˆë©ë‹ˆë‹¤.
  - store001 : í…ŒìŠ¤íŠ¸ ì „ì— ë¯¸ë¦¬ ìƒì„±ë˜ì–´ ìˆëŠ” ì§€ì  ì•„ì´ë””ì…ë‹ˆë‹¤.
  - b_test_01 : í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ì§€ì  ì•„ì´ë””ë¥¼ ìƒˆë¡œ ìƒì„±í• ë•Œ ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤. (ì´íŒ-ëŒ€ë¦¬ì -ì§€ì  ë“±ë¡/ìˆ˜ì • ë“±ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•¨)

- ê° ë‹¨ê³„ë³„ ì„œë¸Œê´€ë¦¬ì
  - ê° ë‹¨ê³„ë³„ë¡œ ìƒì„±ë˜ì–´ ìˆëŠ” ì„œë¸Œê´€ë¦¬ì ì•„ì´ë””ëŠ” í…ŒìŠ¤íŠ¸ë¡œ ì´ìš©í•  ì¼ì´ ì—†ìœ¼ë©° í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ì„œëŠ” í…ŒìŠ¤íŠ¸ìš© ì„œë¸Œê´€ë¦¬ìë¥¼ ìƒì„±í•´ì„œ í…ŒìŠ¤íŠ¸ í•´ì•¼ í•©ë‹ˆë‹¤. 
  - ê° ë©”ë‰´ë“¤ì— ëŒ€í•œ ê³„ì¸µë³„ í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ë©´ ê° ê³„ì¸µë³„ í•´ë‹¹ ë©”ë‰´ì— ëŒ€í•œ ì„œë¸Œ ê´€ë¦¬ìë¥¼ ë“±ë¡í›„ ê¶Œí•œì„ ë¶€ì—¬í•˜ì—¬ ê° ê¶Œí•œë³„ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
  - ì½ê¸° ê¶Œí•œë§Œ ì„¤ì •í•˜ê³  ì½ê¸° ê¶Œí•œ ê°€ëŠ¥, ì“°ê¸° ê¶Œí•œ ë¶ˆê°€ëŠ¥, ì‚­ì œ ê¶Œí•œ ë¶ˆê°€ëŠ¥ ì—¬ë¶€ë¥¼ í…ŒìŠ¤íŠ¸ í•´ì•¼ í•©ë‹ˆë‹¤. 
  - ë§ˆì°¬ê°€ì§€ë¡œ ì“°ê¸°, ì‚­ì œ ê¶Œí•œë„ ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

- ê° ê´€ë¦¬ì ë“±ë¡ì‹œ ë“±ë¡ í•„ë“œ ì…ë ¥ ë°©ë²• (ë“±ë¡í˜ì´ì§€ë§ˆë‹¤ í•„ë“œëŠ” ë‹¤ë¥´ì§€ë§Œ í˜•ì‹ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.)
  - ë¹„ë°€ ë²ˆí˜¸: !{ì•„ì´ë””}$.
  - ì´ë¦„ : {ì•„ì´ë””}
  - íšŒì‚¬ëª… : {ì•„ì´ë””}íšŒì‚¬
  - ë‹‰ë„¤ì„ : {ì•„ì´ë””}
  - ì´ë©”ì¼ : {ì•„ì´ë””}@mail.com

- ê´€ë¦¬ì ì •ë³´ ìˆ˜ì •ì€ 'íšŒì‚¬ëª…' ìˆ˜ì •ë§Œ í…ŒìŠ¤íŠ¸ í•©ë‹ˆë‹¤. 
  - {ì•„ì´ë””}íšŒì‚¬ -> {ì•„ì´ë””}ìˆ˜ì •ì •


## í•µì‹¬ UI ì»´í¬ë„ŒíŠ¸

### Chained Select (ì—°ì‡„ ì„ íƒ ë°•ìŠ¤)
"ì´íŒ â†’ ëŒ€ë¦¬ì  â†’ ì§€ì " ìˆœì„œë¡œ ì„ íƒí•˜ëŠ” ê³„ì¸µì  ì„ íƒ UI
- ìƒìœ„ ì„ íƒì— ë”°ë¼ í•˜ìœ„ ì˜µì…˜ì´ ë™ì ìœ¼ë¡œ ë³€ê²½
- ê¶Œí•œì— ë”°ë¼ í‘œì‹œë˜ëŠ” ì˜µì…˜ì´ ì œí•œë¨

### ë°ì´í„° í…Œì´ë¸”
- `dmk_action_logs`: ê´€ë¦¬ì ì—‘ì…˜ ë¡œê·¸ ì •ë³´
- `dmk_distributors`: ì´íŒ ì •ë³´
- `dmk_agencies`: ëŒ€ë¦¬ì  ì •ë³´
- `dmk_branches`: ì§€ì  ì •ë³´
- `g5_member`: ê´€ë¦¬ì ê³„ì • ì •ë³´
- `g5_auth`: ê¶Œí•œ ì •ë³´

## í…ŒìŠ¤íŠ¸ ë°ì´í„° ê´€ë¦¬

### í…ŒìŠ¤íŠ¸ ê³„ì • ëª…ëª… ê·œì¹™
- ë³¸ì‚¬: `admin` (ê¸°ë³¸ ìµœê³ ê´€ë¦¬ì)
- ì´íŒ: `d_test_XX` (ì˜ˆ: d_test_01)
- ëŒ€ë¦¬ì : `a_test_XX` (ì˜ˆ: a_test_01)
- ì§€ì : `b_test_XX` (ì˜ˆ: b_test_01)
- ì„œë¸Œê´€ë¦¬ì: `{ê³„ì¸µ}_{ì—­í• }_sub_XX` (ì˜ˆ: d_sales_sub_01)

### í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒëª…ì£¼ê¸°
1. **ìƒì„± ìˆœì„œ**: ì´íŒ â†’ ëŒ€ë¦¬ì  â†’ ì§€ì  (ê³„ì¸µ êµ¬ì¡° ìœ ì§€)
2. **ì‚­ì œ ìˆœì„œ**: ì§€ì  â†’ ëŒ€ë¦¬ì  â†’ ì´íŒ (ì—­ìˆœ ì‚­ì œ)
3. **ë°ì´í„° ìœ ì§€**: í•˜ìœ„ ê³„ì¸µ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ìƒìœ„ ê³„ì¸µ ë°ì´í„°ëŠ” ì „ì²´ í…ŒìŠ¤íŠ¸ ì™„ë£Œê¹Œì§€ ìœ ì§€

### ê´€ë¦¬ì ì•¡ì…˜ ë¡œê·¸ ê²€ì¦
ëª¨ë“  ê´€ë¦¬ ì‘ì—…(ì¡°íšŒ/ë“±ë¡/ìˆ˜ì •/ì‚­ì œ)ì€ ê´€ë¦¬ì ì•¡ì…˜ ë¡œê·¸ì— ê¸°ë¡ë˜ë©°, ê° í…ŒìŠ¤íŠ¸ ë‹¨ê³„ì—ì„œ ë¡œê·¸ ê¸°ë¡ ì—¬ë¶€ë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.

## í…ŒìŠ¤íŠ¸ ë°ì´í„° ê´€ë¦¬ ìƒì„¸

### í•µì‹¬ ì›ì¹™

#### 1. ê³„ì¸µì  ì˜ì¡´ì„± ìœ ì§€
- ì´íŒ â†’ ëŒ€ë¦¬ì  â†’ ì§€ì  ìˆœì„œë¡œ ë°ì´í„° ìƒì„±
- ì§€ì  â†’ ëŒ€ë¦¬ì  â†’ ì´íŒ ì—­ìˆœìœ¼ë¡œ ë°ì´í„° ì‚­ì œ
- ìƒìœ„ ê³„ì¸µ ë°ì´í„°ëŠ” í•˜ìœ„ ê³„ì¸µ í…ŒìŠ¤íŠ¸ ì™„ë£Œê¹Œì§€ ìœ ì§€

#### 2. í…ŒìŠ¤íŠ¸ ë°ì´í„° ê²©ë¦¬
- ê° í…ŒìŠ¤íŠ¸ëŠ” ê³ ìœ í•œ ì‹ë³„ìë¥¼ ê°€ì§„ ë°ì´í„° ìƒì„±
- ê¸°ì¡´ ìš´ì˜ ë°ì´í„°ì™€ ì¶©ëŒí•˜ì§€ ì•ŠëŠ” ëª…ëª… ê·œì¹™ ì‚¬ìš©
- í…ŒìŠ¤íŠ¸ ì ‘ë‘ì–´ ì‚¬ìš©: `test_`, `d_test_`, `a_test_`, `b_test_`

### í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒëª…ì£¼ê¸°

#### Phase 1: í…ŒìŠ¤íŠ¸ í™˜ê²½ ì¤€ë¹„
```javascript
// 1. ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ í™•ì¸
async function checkExistingTestData() {
  // test_ ì ‘ë‘ì–´ë¥¼ ê°€ì§„ ë°ì´í„° ì¡°íšŒ
  // ì¡´ì¬í•˜ë©´ ê²½ê³  ë©”ì‹œì§€ ì¶œë ¥
}

// 2. í…ŒìŠ¤íŠ¸ ì‹œì‘ ì „ ìŠ¤ëƒ…ìƒ· ìƒì„± (ì„ íƒì )
async function createDatabaseSnapshot() {
  // í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ ë°±ì—…
}
```

#### Phase 2: ê³„ì¸µë³„ ë°ì´í„° ìƒì„±
```
í…ŒìŠ¤íŠ¸ ìˆœì„œ:
1. ë³¸ì‚¬ ê´€ë¦¬ì í…ŒìŠ¤íŠ¸
   â””â”€ ì´íŒ ìƒì„± (d_test_01, d_test_02)
   
2. ì´íŒ ê´€ë¦¬ì í…ŒìŠ¤íŠ¸
   â””â”€ ëŒ€ë¦¬ì  ìƒì„± (a_test_01, a_test_02)
   
3. ëŒ€ë¦¬ì  ê´€ë¦¬ì í…ŒìŠ¤íŠ¸
   â””â”€ ì§€ì  ìƒì„± (b_test_01, b_test_02)
   
4. ê° ê³„ì¸µ ì„œë¸Œê´€ë¦¬ì í…ŒìŠ¤íŠ¸
   â””â”€ ì„œë¸Œê´€ë¦¬ì ê³„ì • ìƒì„±
```

#### Phase 3: í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬
```
ì •ë¦¬ ìˆœì„œ (ì—­ìˆœ):
1. ì„œë¸Œê´€ë¦¬ì ê³„ì • ì‚­ì œ
2. ì§€ì  ë°ì´í„° ì‚­ì œ
3. ëŒ€ë¦¬ì  ë°ì´í„° ì‚­ì œ
4. ì´íŒ ë°ì´í„° ì‚­ì œ
5. ê´€ë ¨ ë¡œê·¸ ë°ì´í„° ì •ë¦¬ (ì„ íƒì )
```

### ë°ì´í„° ì •ë¦¬ êµ¬í˜„ ë°©ë²•

#### 1. AfterAll Hook í™œìš©
```javascript
test.afterAll(async ({ page }) => {
  // ì „ì²´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ ë°ì´í„° ì •ë¦¬
  await cleanupTestData(page);
});
```

#### 2. ê³„ì¸µë³„ ì‚­ì œ í•¨ìˆ˜
```javascript
async function cleanupTestData(page) {
  // 1. ì§€ì  ì‚­ì œ
  await deleteBranches(page, ['b_test_01', 'b_test_02']);
  
  // 2. ëŒ€ë¦¬ì  ì‚­ì œ
  await deleteAgencies(page, ['a_test_01', 'a_test_02']);
  
  // 3. ì´íŒ ì‚­ì œ
  await deleteDistributors(page, ['d_test_01', 'd_test_02']);
  
  // 4. ì„œë¸Œê´€ë¦¬ì ì‚­ì œ
  await deleteSubAdmins(page, [
    'd_sales_sub_01',
    'a_order_sub_01',
    'b_staff_sub_01'
  ]);
}
```

#### 3. ì•ˆì „í•œ ì‚­ì œ ì²˜ë¦¬
```javascript
async function deleteWithRetry(page, deleteFunction, id, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      await deleteFunction(page, id);
      return true;
    } catch (error) {
      if (error.message.includes('í•˜ìœ„ ì¡°ì§ì´ ì¡´ì¬')) {
        // í•˜ìœ„ ì¡°ì§ ë¨¼ì € ì‚­ì œ í›„ ì¬ì‹œë„
        await wait(1000);
        continue;
      }
      throw error;
    }
  }
  return false;
}
```

### ê´€ë¦¬ì ì•¡ì…˜ ë¡œê·¸ ê²€ì¦ ìƒì„¸

#### 1. ë¡œê·¸ ê¸°ë¡ í•­ëª©
- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
- ì¡°íšŒ (ëª©ë¡, ìƒì„¸)
- ë“±ë¡
- ìˆ˜ì •
- ì‚­ì œ
- ê¶Œí•œ ë³€ê²½

#### 2. ë¡œê·¸ ê²€ì¦ í•¨ìˆ˜
```javascript
async function verifyActionLog(page, action, target, adminId) {
  // dmk_action_logs í…Œì´ë¸” ì¡°íšŒ
  const log = await page.evaluate(async (params) => {
    // Ajax ë˜ëŠ” ì§ì ‘ DB ì¡°íšŒë¡œ ìµœê·¼ ë¡œê·¸ í™•ì¸
    const response = await fetch('/adm/ajax_get_admin_log.php', {
      method: 'POST',
      body: JSON.stringify({
        action: params.action,
        target: params.target,
        admin_id: params.adminId,
        limit: 1
      })
    });
    return response.json();
  }, { action, target, adminId });
  
  expect(log).toBeTruthy();
  expect(log.action).toBe(action);
  expect(log.target).toContain(target);
}
```

#### 3. ê° í…ŒìŠ¤íŠ¸ ë‹¨ê³„ë³„ ë¡œê·¸ ê²€ì¦
```javascript
// ì´íŒ ë“±ë¡ í›„
await verifyActionLog(page, 'INSERT', 'd_test_01', 'admin');

// ëŒ€ë¦¬ì  ìˆ˜ì • í›„
await verifyActionLog(page, 'UPDATE', 'a_test_01', 'd_test_01');

// ì§€ì  ì‚­ì œ í›„
await verifyActionLog(page, 'DELETE', 'b_test_01', 'a_test_01');
```

### í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒíƒœ ê´€ë¦¬

#### 1. í…ŒìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ ê³µìœ 
```javascript
// test-context.js
export const testContext = {
  createdDistributors: [],
  createdAgencies: [],
  createdBranches: [],
  createdSubAdmins: [],
  
  addDistributor(id) {
    this.createdDistributors.push(id);
  },
  
  addAgency(id) {
    this.createdAgencies.push(id);
  },
  
  // ... ê¸°íƒ€ ë©”ì„œë“œ
};
```

#### 2. í…ŒìŠ¤íŠ¸ ê°„ ë°ì´í„° ì „ë‹¬
```javascript
test.describe('í”„ëœì°¨ì´ì¦ˆ ê´€ë¦¬ í†µí•© í…ŒìŠ¤íŠ¸', () => {
  test('ì´íŒ ìƒì„±', async ({ page }) => {
    // ì´íŒ ìƒì„±
    await createDistributor(page, 'd_test_01');
    testContext.addDistributor('d_test_01');
  });
  
  test('ëŒ€ë¦¬ì  ìƒì„±', async ({ page }) => {
    // ì´ì „ í…ŒìŠ¤íŠ¸ì—ì„œ ìƒì„±í•œ ì´íŒ ì‚¬ìš©
    const distributorId = testContext.createdDistributors[0];
    await createAgency(page, 'a_test_01', distributorId);
    testContext.addAgency('a_test_01');
  });
});
```

### ì˜ˆì™¸ ìƒí™© ì²˜ë¦¬

#### 1. ë¶€ë¶„ ì‹¤íŒ¨ ì‹œ ì •ë¦¬
- í…ŒìŠ¤íŠ¸ ì¤‘ê°„ ì‹¤íŒ¨ ì‹œì—ë„ ìƒì„±ëœ ë°ì´í„°ëŠ” ì •ë¦¬
- try-finally ë¸”ë¡ í™œìš©

#### 2. ì •ë¦¬ ì‹¤íŒ¨ ì‹œ ë¡œê¹…
```javascript
async function cleanupWithLogging(page) {
  const failures = [];
  
  for (const id of testContext.createdBranches) {
    try {
      await deleteBranch(page, id);
    } catch (error) {
      failures.push({ type: 'branch', id, error: error.message });
    }
  }
  
  if (failures.length > 0) {
    console.error('í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ ì‹¤íŒ¨:', failures);
    // ìˆ˜ë™ ì •ë¦¬ í•„ìš” ì•Œë¦¼
  }
}
```

#### 3. ìˆ˜ë™ ì •ë¦¬ ìŠ¤í¬ë¦½íŠ¸
```sql
-- í…ŒìŠ¤íŠ¸ ë°ì´í„° ìˆ˜ë™ ì •ë¦¬ SQL
-- ì£¼ì˜: test_ ì ‘ë‘ì–´ë¥¼ ê°€ì§„ ë°ì´í„°ë§Œ ì‚­ì œ

-- ì§€ì  ì‚­ì œ
DELETE FROM dmk_branches WHERE branch_id LIKE 'b_test_%';

-- ëŒ€ë¦¬ì  ì‚­ì œ
DELETE FROM dmk_agencies WHERE agency_id LIKE 'a_test_%';

-- ì´íŒ ì‚­ì œ
DELETE FROM dmk_distributors WHERE distributor_id LIKE 'd_test_%';

-- ê´€ë ¨ íšŒì› ì‚­ì œ
DELETE FROM g5_member WHERE mb_id LIKE '%_test_%' AND mb_level IN (8,7,6,5);

-- ê¶Œí•œ ì‚­ì œ
DELETE FROM g5_auth WHERE mb_id LIKE '%_test_%';
```

### ëª¨ë²” ì‚¬ë¡€

#### 1. í…ŒìŠ¤íŠ¸ ë…ë¦½ì„± ë³´ì¥
- ê° í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ì— ì˜ì¡´í•˜ì§€ ì•Šë„ë¡ ì„¤ê³„
- í•„ìš”í•œ ì „ì œ ì¡°ê±´ì€ ê° í…ŒìŠ¤íŠ¸ì—ì„œ ì§ì ‘ ìƒì„±

#### 2. ëª…í™•í•œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‹ë³„
- í…ŒìŠ¤íŠ¸ ë°ì´í„°ëŠ” ëª…í™•í•œ ì ‘ë‘ì–´/ì ‘ë¯¸ì–´ ì‚¬ìš©
- ì‹¤ì œ ìš´ì˜ ë°ì´í„°ì™€ êµ¬ë¶„ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„

#### 3. ì •ë¦¬ ê²€ì¦
- ë°ì´í„° ì •ë¦¬ í›„ ì‹¤ì œë¡œ ì‚­ì œë˜ì—ˆëŠ”ì§€ ê²€ì¦
- ê´€ë ¨ ì—°ê²° ë°ì´í„°ë„ í•¨ê»˜ ì •ë¦¬ë˜ì—ˆëŠ”ì§€ í™•ì¸

#### 4. ë¡œê·¸ ë³´ì¡´
- í…ŒìŠ¤íŠ¸ ê´€ë ¨ ë¡œê·¸ëŠ” ë³„ë„ë¡œ ë³´ì¡´
- ë¬¸ì œ ë°œìƒ ì‹œ ì¶”ì  ê°€ëŠ¥í•˜ë„ë¡ ê´€ë¦¬

## í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë°©ë²•

### ê¸°ë³¸ ì‹¤í–‰ ëª…ë ¹ì–´
```bash
# ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npx playwright test

# íŠ¹ì • í…ŒìŠ¤íŠ¸ íŒŒì¼ ì‹¤í–‰
npx playwright test headquarters.spec.ts

# ë””ë²„ê·¸ ëª¨ë“œë¡œ ì‹¤í–‰
npx playwright test --debug

# í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¦¬í¬íŠ¸ ë³´ê¸°
npx playwright show-report
```

### ê³ ê¸‰ ì‹¤í–‰ ì „ëµ
í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ëª¨ë“œ, ë³‘ë ¬ ì²˜ë¦¬, ë°ì´í„° ì •ë¦¬ ë¶„ë¦¬ ë“± ìƒì„¸í•œ ì‹¤í–‰ ì „ëµì€ `test-execution-strategy.md` ì°¸ì¡°

## ë‹¤ìŒ ë‹¨ê³„

1. ê° ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ë¬¸ì„œ ì‘ì„±
2. Playwright í…ŒìŠ¤íŠ¸ ì½”ë“œ êµ¬í˜„
3. CI/CD íŒŒì´í”„ë¼ì¸ í†µí•©
4. í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ë¶„ì„




# í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ëµ ë° ê°€ì´ë“œ

## ê°œìš”
Playwright í…ŒìŠ¤íŠ¸ì˜ íš¨ìœ¨ì ì¸ ì‹¤í–‰ê³¼ ê´€ë¦¬ë¥¼ ìœ„í•œ ì „ëµì„ ì •ì˜í•©ë‹ˆë‹¤.

## í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ëª¨ë“œ

### 1. í—¤ë“œí’€ ëª¨ë“œ (ê°œë°œ/ë””ë²„ê¹…ìš©)
ë¸Œë¼ìš°ì € UIë¥¼ í‘œì‹œí•˜ì—¬ í…ŒìŠ¤íŠ¸ ì§„í–‰ ìƒí™©ì„ ì‹œê°ì ìœ¼ë¡œ í™•ì¸

```bash
# í—¤ë“œí’€ ëª¨ë“œë¡œ ì‹¤í–‰
npx playwright test --headed

# ë””ë²„ê·¸ ëª¨ë“œë¡œ ì‹¤í–‰ (ì¤‘ë‹¨ì  ì‚¬ìš© ê°€ëŠ¥)
npx playwright test --debug

# íŠ¹ì • í…ŒìŠ¤íŠ¸ë§Œ í—¤ë“œí’€ ëª¨ë“œë¡œ ì‹¤í–‰
npx playwright test headquarters.spec.ts --headed

# ëŠë¦° ì†ë„ë¡œ ì‹¤í–‰ (ê° ì•¡ì…˜ í™•ì¸ ê°€ëŠ¥)
npx playwright test --headed --slow-mo=1000
```

### 2. í—¤ë“œë¦¬ìŠ¤ ëª¨ë“œ (CI/CDìš©)
ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë¹ ë¥´ê²Œ ì‹¤í–‰

```bash
# ê¸°ë³¸ í—¤ë“œë¦¬ìŠ¤ ëª¨ë“œ
npx playwright test

# ë³‘ë ¬ ì‹¤í–‰ (ê¸°ë³¸ê°’)
npx playwright test --workers=4

# ìˆœì°¨ ì‹¤í–‰
npx playwright test --workers=1
```

### 3. í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•
ê°œë°œ ë‹¨ê³„ë³„ë¡œ ë‹¤ë¥¸ ëª¨ë“œ ì‚¬ìš©

```javascript
// playwright.config.ts
export default defineConfig({
  use: {
    // í™˜ê²½ë³€ìˆ˜ë¡œ ëª¨ë“œ ì œì–´
    headless: process.env.CI ? true : false,
    
    // ê°œë°œ í™˜ê²½ì—ì„œë§Œ ëŠë¦° ëª¨ì…˜
    slowMo: process.env.CI ? 0 : 500,
    
    // ìŠ¤í¬ë¦°ìƒ· ì„¤ì •
    screenshot: 'only-on-failure',
    video: process.env.CI ? 'retain-on-failure' : 'on',
  },
});
```

## í…ŒìŠ¤íŠ¸ì™€ ë°ì´í„° ì •ë¦¬ ë¶„ë¦¬

### 1. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë‹¨ê³„
```bash
# 1ë‹¨ê³„: í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰ (ë°ì´í„° ì •ë¦¬ ì—†ìŒ)
npm run test:no-cleanup

# 2ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ê²°ê³¼ í™•ì¸
npm run test:report

# 3ë‹¨ê³„: ë°ì´í„° ì •ë¦¬ (ë³„ë„ ì‹¤í–‰)
npm run test:cleanup
```

### 2. package.json ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •
```json
{
  "scripts": {
    "test": "playwright test",
    "test:headed": "playwright test --headed",
    "test:debug": "playwright test --debug",
    "test:no-cleanup": "SKIP_CLEANUP=true playwright test",
    "test:cleanup": "node scripts/cleanup-test-data.js",
    "test:full": "npm run test:no-cleanup && npm run test:cleanup",
    "test:report": "playwright show-report"
  }
}
```

### 3. ì¡°ê±´ë¶€ ì •ë¦¬ êµ¬í˜„
```javascript
// tests/helpers/cleanup.ts
export async function conditionalCleanup(page: Page) {
  if (process.env.SKIP_CLEANUP === 'true') {
    console.log('í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ ê±´ë„ˆë›°ê¸° (SKIP_CLEANUP=true)');
    return;
  }
  
  await cleanupTestData(page);
}

// í…ŒìŠ¤íŠ¸ íŒŒì¼ì—ì„œ
test.afterAll(async ({ page }) => {
  await conditionalCleanup(page);
});
```

### 4. ë…ë¦½ì ì¸ ì •ë¦¬ ìŠ¤í¬ë¦½íŠ¸
```javascript
// scripts/cleanup-test-data.js
const { chromium } = require('@playwright/test');

async function cleanupAllTestData() {
  const browser = await chromium.launch();
  const page = await browser.newPage();
  
  try {
    // ê´€ë¦¬ì ë¡œê·¸ì¸
    await page.goto('http://domaeka.local/adm');
    await page.fill('#login_id', 'admin');
    await page.fill('#login_pw', '!domaekaservice@.');
    await page.click('button[type="submit"]');
    
    // ê³„ì¸µë³„ ë°ì´í„° ì‚­ì œ (ì—­ìˆœ)
    await deleteAllTestBranches(page);
    await deleteAllTestAgencies(page);
    await deleteAllTestDistributors(page);
    await deleteAllTestSubAdmins(page);
    
    console.log('í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ');
  } catch (error) {
    console.error('ë°ì´í„° ì •ë¦¬ ì‹¤íŒ¨:', error);
  } finally {
    await browser.close();
  }
}

cleanupAllTestData();
```

## ë³‘ë ¬ í…ŒìŠ¤íŠ¸ ì „ëµ

### 1. ë³‘ë ¬ ì‹¤í–‰ ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ ê·¸ë£¹

#### ê·¸ë£¹ A: ë…ë¦½ì ì¸ ì½ê¸° ì „ìš© í…ŒìŠ¤íŠ¸
- ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
- ë©”ë‰´ ì ‘ê·¼ ê¶Œí•œ í…ŒìŠ¤íŠ¸
- ëª©ë¡ ì¡°íšŒ í…ŒìŠ¤íŠ¸
- ê¶Œí•œ ì—†ëŠ” í˜ì´ì§€ ì ‘ê·¼ ì°¨ë‹¨ í…ŒìŠ¤íŠ¸

#### ê·¸ë£¹ B: ì„œë¡œ ë‹¤ë¥¸ ê³„ì¸µì˜ ë…ë¦½ì  í…ŒìŠ¤íŠ¸
- ì„œë¡œ ë‹¤ë¥¸ ì´íŒì˜ ì„œë¸Œê´€ë¦¬ì í…ŒìŠ¤íŠ¸
- ì„œë¡œ ë‹¤ë¥¸ ëŒ€ë¦¬ì ì˜ ì„œë¸Œê´€ë¦¬ì í…ŒìŠ¤íŠ¸
- ì„œë¡œ ë‹¤ë¥¸ ì§€ì ì˜ ì„œë¸Œê´€ë¦¬ì í…ŒìŠ¤íŠ¸

### 2. ìˆœì°¨ ì‹¤í–‰ í•„ìš”í•œ í…ŒìŠ¤íŠ¸ ê·¸ë£¹

#### ê·¸ë£¹ X: ê³„ì¸µ êµ¬ì¡° ì˜ì¡´ì„±ì´ ìˆëŠ” í…ŒìŠ¤íŠ¸
```
ìˆœì°¨ ì‹¤í–‰ ìˆœì„œ:
1. ì´íŒ ìƒì„± í…ŒìŠ¤íŠ¸
2. ëŒ€ë¦¬ì  ìƒì„± í…ŒìŠ¤íŠ¸ (ì´íŒ í•„ìš”)
3. ì§€ì  ìƒì„± í…ŒìŠ¤íŠ¸ (ëŒ€ë¦¬ì  í•„ìš”)
4. ê³„ì¸µ êµ¬ì¡° ë³€ê²½ í…ŒìŠ¤íŠ¸
5. ë°ì´í„° ì •ë¦¬ í…ŒìŠ¤íŠ¸
```

### 3. ë³‘ë ¬ í…ŒìŠ¤íŠ¸ êµ¬ì„±
```javascript
// playwright.config.ts
export default defineConfig({
  projects: [
    {
      name: 'auth-tests',
      testMatch: /auth\.spec\.ts/,
      fullyParallel: true,
    },
    {
      name: 'hierarchy-tests',
      testMatch: /hierarchy\.spec\.ts/,
      fullyParallel: false, // ìˆœì°¨ ì‹¤í–‰
    },
    {
      name: 'sub-admin-tests',
      testMatch: /sub-admin-.*\.spec\.ts/,
      fullyParallel: true,
    },
  ],
  
  // ì „ì—­ ë³‘ë ¬ ì„¤ì •
  workers: process.env.CI ? 2 : 4,
  fullyParallel: false, // ê¸°ë³¸ê°’ì€ ìˆœì°¨
});
```

### 4. í…ŒìŠ¤íŠ¸ ê²©ë¦¬ë¥¼ ìœ„í•œ ë°ì´í„° ë„¤ì´ë°
```javascript
// ë³‘ë ¬ ì‹¤í–‰ ì‹œ ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•œ ê³ ìœ  ID ìƒì„±
function generateTestId(prefix: string): string {
  const timestamp = Date.now();
  const random = Math.random().toString(36).substring(2, 5);
  return `${prefix}_${timestamp}_${random}`;
}

// ì‚¬ìš© ì˜ˆ
const distributorId = generateTestId('d_test'); // d_test_1703123456_abc
const agencyId = generateTestId('a_test');     // a_test_1703123457_def
```

## í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ê°œë°œ ì¤‘ (ì‹œê°ì  í™•ì¸ í•„ìš”)
```bash
# 1. í—¤ë“œí’€ ëª¨ë“œë¡œ ë‹¨ì¼ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npx playwright test headquarters.spec.ts --headed --workers=1

# 2. ë¬¸ì œ ë°œìƒ ì‹œ ë””ë²„ê·¸ ëª¨ë“œ
npx playwright test headquarters.spec.ts --debug

# 3. ë°ì´í„° ì •ë¦¬ ê±´ë„ˆë›°ê¸° (ì¬ì‹¤í–‰ì„ ìœ„í•´)
SKIP_CLEANUP=true npx playwright test headquarters.spec.ts --headed
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
# 1. í—¤ë“œë¦¬ìŠ¤ ëª¨ë“œë¡œ ì „ì²´ í…ŒìŠ¤íŠ¸
npm run test

# 2. ì‹¤íŒ¨í•œ í…ŒìŠ¤íŠ¸ë§Œ ì¬ì‹¤í–‰
npx playwright test --last-failed

# 3. í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ ë°ì´í„° ì •ë¦¬
npm run test:cleanup
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: CI/CD íŒŒì´í”„ë¼ì¸
```yaml
# .github/workflows/test.yml
jobs:
  test:
    steps:
      - name: Run tests
        run: |
          npm run test:no-cleanup
          
      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: playwright-report
          path: playwright-report/
          
      - name: Cleanup test data
        if: always()
        run: npm run test:cleanup
```

## ì„±ëŠ¥ ìµœì í™”

### 1. ë¸Œë¼ìš°ì € ì»¨í…ìŠ¤íŠ¸ ì¬ì‚¬ìš©
```javascript
// ê°™ì€ ê¶Œí•œ í…ŒìŠ¤íŠ¸ëŠ” ì»¨í…ìŠ¤íŠ¸ ê³µìœ 
test.describe('ì´íŒ ê´€ë¦¬ì í…ŒìŠ¤íŠ¸', () => {
  let context: BrowserContext;
  
  test.beforeAll(async ({ browser }) => {
    context = await browser.newContext();
    const page = await context.newPage();
    await loginAsDistributor(page);
  });
  
  test.afterAll(async () => {
    await context.close();
  });
  
  test('í…ŒìŠ¤íŠ¸ 1', async () => {
    const page = await context.newPage();
    // ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœë¡œ í…ŒìŠ¤íŠ¸
  });
});
```

### 2. ì„ íƒì  ëŒ€ê¸° ì „ëµ
```javascript
// ëŠë¦° í™˜ê²½ì„ ìœ„í•œ ëŒ€ê¸° ì‹œê°„ ì¡°ì •
const waitOptions = {
  timeout: process.env.CI ? 30000 : 10000,
};

await page.waitForSelector('.distributor-list', waitOptions);
```

### 3. ë¦¬ì†ŒìŠ¤ ìµœì í™”
```javascript
// ì´ë¯¸ì§€/í°íŠ¸ ë¡œë”© ì°¨ë‹¨ìœ¼ë¡œ ì†ë„ í–¥ìƒ
await page.route('**/*.{png,jpg,jpeg,gif,webp,svg,woff,woff2}', 
  route => route.abort()
);
```

## ëª¨ë‹ˆí„°ë§ ë° ë¦¬í¬íŒ…

### 1. ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™©
```javascript
// ì»¤ìŠ¤í…€ ë¦¬í¬í„°ë¡œ ì§„í–‰ ìƒí™© í‘œì‹œ
class ProgressReporter {
  onTestBegin(test) {
    console.log(`ğŸƒ ì‹œì‘: ${test.title}`);
  }
  
  onTestEnd(test, result) {
    const emoji = result.status === 'passed' ? 'âœ…' : 'âŒ';
    console.log(`${emoji} ì™„ë£Œ: ${test.title} (${result.duration}ms)`);
  }
}
```

### 2. í…ŒìŠ¤íŠ¸ ê²°ê³¼ ëŒ€ì‹œë³´ë“œ
```bash
# HTML ë¦¬í¬íŠ¸ ìƒì„± ë° ì—´ê¸°
npx playwright show-report

# JSON í˜•ì‹ìœ¼ë¡œ ê²°ê³¼ ì €ì¥
npx playwright test --reporter=json > test-results.json
```

## ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

### ë³‘ë ¬ ì‹¤í–‰ ì‹œ ì¶©ëŒ
- ê³ ìœ  ID ìƒì„± í•¨ìˆ˜ ì‚¬ìš©
- í…ŒìŠ¤íŠ¸ ê°„ ë°ì´í„° ê²©ë¦¬ í™•ì¸
- í•„ìš”ì‹œ ìˆœì°¨ ì‹¤í–‰ìœ¼ë¡œ ì „í™˜

### í—¤ë“œí’€ ëª¨ë“œ ì†ë„ ë¬¸ì œ
- `slowMo` ê°’ ì¡°ì •
- íŠ¹ì • ì•¡ì…˜ë§Œ ëŠë¦¬ê²Œ ì‹¤í–‰
- ìŠ¤í¬ë¦°ìƒ·/ë¹„ë””ì˜¤ ê¸°ë¡ ìµœì†Œí™”

### ë°ì´í„° ì •ë¦¬ ì‹¤íŒ¨
- ìˆ˜ë™ ì •ë¦¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
- ë°ì´í„°ë² ì´ìŠ¤ ì§ì ‘ ì ‘ê·¼
- ì •ë¦¬ ë¡œê·¸ í™•ì¸ ë° ì¬ì‹œë„