# 본사 최고관리자 테스트 시나리오

## 테스트 개요
- **테스트 대상**: 본사 최고관리자 (admin)
- **테스트 목적**: 본사 최고관리자의 모든 계층 관리 권한 검증
- **로그인 정보**: admin / !domaekaservice@.

## 사전 조건
- 테스트 데이터베이스가 초기화된 상태
- 기존 테스트 데이터가 정리된 상태

## 테스트 시나리오

### 1. 총판 관리 테스트

#### 1.1 총판 목록 조회
1. 웹 관리페이지 접속 (http://domaeka.local/adm)
2. 최고관리자 계정으로 로그인
3. [프랜차이즈 관리] > "총판관리" 메뉴 클릭
4. **검증**:
   - 총판 목록 페이지가 표시되는지 확인
   - MySQL MCP로 확인한 `g5_dmk_distributors` 테이블의 데이터가 모두 표시되는지 확인
   - 각 총판의 ID, 이름, 회사명, 연락처 정보가 올바르게 표시되는지 확인

#### 1.2 총판 등록
1. 우측 상단의 "+ 총판 등록" 버튼 클릭
2. 총판 등록 폼에 다음 정보 입력:
   - 총판 ID: `d_test_01`
   - 비밀번호: `d_test_01`
   - 총판명: `d_test_01`
   - 회사명: `d_test_01총판`
   - 이메일: `d_test_01@gmail.com`
   - 연락처: `010-1234-5678`
3. "총판 등록" 버튼 클릭
4. **검증**:
   - 성공 메시지가 표시되는지 확인
   - 목록 페이지로 리다이렉트되는지 확인
   - 등록된 총판이 목록에 표시되는지 확인
   - 데이터베이스에 올바르게 저장되었는지 확인
   - **관리자 액션 로그**: 총판 등록 액션이 기록되었는지 확인 (action: 'INSERT', target: 'd_test_01')

#### 1.3 총판 수정
1. 등록된 총판(d_test_01)의 "수정" 버튼 클릭
2. 수정 폼에서 다음 정보 변경:
   - 회사명: `d_test_01총판` → `d_test_01총판2`
   - 연락처: `010-1234-5678` → `010-1234-5679`
3. "총판 정보 수정" 버튼 클릭
4. **검증**:
   - 수정 성공 메시지가 표시되는지 확인
   - 목록 페이지에서 변경된 정보가 올바르게 표시되는지 확인
   - 데이터베이스에 변경사항이 반영되었는지 확인
   - **관리자 액션 로그**: 총판 수정 액션이 기록되었는지 확인 (action: 'UPDATE', target: 'd_test_01')

### 2. 대리점 관리 테스트

#### 2.1 대리점 목록 조회
1. [프랜차이즈 관리] > "대리점관리" 메뉴 클릭
2. **검증**:
   - 대리점 목록 페이지가 표시되는지 확인
   - 상단에 총판 선택 박스만 표시되는지 확인 (대리점 선택 박스는 미표시)
   - 총판을 선택하지 않은 상태에서는 모든 대리점이 표시되는지 확인

#### 2.2 총판별 대리점 필터링
1. 총판 선택 박스에서 `d_test_01` 선택
2. **검증**:
   - 선택한 총판 소속 대리점만 표시되는지 확인
   - 다른 총판 소속 대리점은 표시되지 않는지 확인

#### 2.3 대리점 등록
1. "+ 대리점 등록" 버튼 클릭
2. 대리점 등록 폼에 다음 정보 입력:
   - 소속 총판: `d_test_01` (선택)
   - 대리점 ID: `a_test_01`
   - 비밀번호: `a_test_01`
   - 대리점명: `a_test_01`
   - 회사명: `a_test_01대리점`
   - 이메일: `a_test_01@gmail.com`
   - 연락처: `010-2345-6789`
3. "확인" 버튼 클릭
4. **검증**:
   - 등록 성공 메시지가 표시되는지 확인
   - 목록 페이지로 리다이렉트되는지 확인
   - 등록된 대리점이 목록에 표시되는지 확인
   - 소속 총판이 올바르게 표시되는지 확인

#### 2.4 대리점 수정
1. 등록된 대리점(a_test_01)의 "수정" 버튼 클릭
2. 수정 폼에서 다음 정보 변경:
   - 회사명: `a_test_01대리점` → `a_test_01대리점2`
   - 연락처: `010-2345-6789` → `010-2345-6780`
3. "대리점 정보 수정" 버튼 클릭
4. **검증**:
   - 수정 성공 메시지가 표시되는지 확인
   - 목록 페이지에서 변경된 정보가 올바르게 표시되는지 확인

### 3. 지점 관리 테스트

#### 3.1 지점 목록 조회
1. [프랜차이즈 관리] > "지점관리" 메뉴 클릭
2. **검증**:
   - 지점 목록 페이지가 표시되는지 확인
   - 상단에 "총판 → 대리점" Chained Select가 표시되는지 확인
   - 초기 상태에서는 모든 지점이 표시되는지 확인

#### 3.2 Chained Select 동작 테스트
1. 총판 선택 박스에서 `d_test_01` 선택
2. **검증**:
   - 대리점 선택 박스가 활성화되는지 확인
   - 선택한 총판 소속 대리점만 옵션에 표시되는지 확인
3. 대리점 선택 박스에서 `a_test_01` 선택
4. **검증**:
   - 선택한 대리점 소속 지점만 목록에 표시되는지 확인

#### 3.3 지점 등록
1. "+ 지점 등록" 버튼 클릭
2. 지점 등록 폼에 다음 정보 입력:
   - 소속 총판: `d_test_01` (선택)
   - 소속 대리점: `a_test_01` (선택)
   - 지점 ID: `b_test_01`
   - 비밀번호: `b_test_01`
   - 지점명: `b_test_01`
   - 회사명: `b_test_01지점`
   - 이메일: `b_test_01@gmail.com`
   - 연락처: `010-3456-7890`
3. "확인" 버튼 클릭
4. **검증**:
   - 등록 성공 메시지가 표시되는지 확인
   - 목록 페이지로 리다이렉트되는지 확인
   - 등록된 지점이 목록에 표시되는지 확인
   - 소속 총판/대리점이 올바르게 표시되는지 확인

### 4. 권한 경계 테스트

#### 4.1 전체 접근 권한 확인
1. 본사 최고관리자로 로그인한 상태에서
2. **검증**:
   - 모든 총판 정보에 접근 가능한지 확인
   - 모든 대리점 정보에 접근 가능한지 확인
   - 모든 지점 정보에 접근 가능한지 확인
   - 모든 계층의 수정/삭제 권한이 있는지 확인

### 5. 데이터 일관성 테스트

#### 5.1 계층 구조 일관성
1. 총판 삭제 시도
2. **검증**:
   - 하위 대리점이 있는 총판은 삭제 불가능한지 확인
   - 적절한 오류 메시지가 표시되는지 확인

#### 5.2 중복 ID 검증
1. 이미 존재하는 ID로 등록 시도
2. **검증**:
   - 중복 ID 등록이 차단되는지 확인
   - 적절한 오류 메시지가 표시되는지 확인

## 예상 결과

모든 테스트가 통과되어야 하며, 본사 최고관리자는:
- 모든 계층의 데이터를 조회할 수 있어야 함
- 모든 계층의 데이터를 등록/수정/삭제할 수 있어야 함
- Chained Select UI가 올바르게 동작해야 함
- 데이터 일관성이 유지되어야 함

## 테스트 후 정리

### 데이터 정리 순서 (중요)
테스트 데이터는 계층 구조 의존성 때문에 역순으로 삭제해야 합니다: 일단 당분간 자동 삭제 기능은 사용하지 않음.

1. **지점 데이터 삭제**
   - `b_test_01` 삭제
   - 삭제 액션 로그 확인

2. **대리점 데이터 삭제**
   - `a_test_01` 삭제
   - 삭제 액션 로그 확인

3. **총판 데이터 삭제**
   - `d_test_01` 삭제
   - 삭제 액션 로그 확인

4. **서브관리자 계정 삭제** (해당되는 경우)
   - 생성된 서브관리자 계정 삭제
   - 관련 권한(g5_auth) 데이터 정리

### 정리 실패 시 수동 처리
```sql
-- 테스트 데이터 수동 삭제 쿼리
DELETE FROM g5_dmk_branches WHERE branch_id = 'b_test_01';
DELETE FROM g5_dmk_agencies WHERE agency_id = 'a_test_01';
DELETE FROM g5_dmk_distributors WHERE distributor_id = 'd_test_01';
DELETE FROM g5_member WHERE mb_id IN ('d_test_01', 'a_test_01', 'b_test_01');
DELETE FROM g5_auth WHERE mb_id IN ('d_test_01', 'a_test_01', 'b_test_01');
```

### 주의사항
- 하위 계층 데이터가 있는 상태에서는 상위 계층을 삭제할 수 없음
- 모든 테스트가 완료된 후에만 데이터 정리 시작
- 다른 테스트 시나리오에서 사용할 데이터는 유지