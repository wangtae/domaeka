# 대리점 서브관리자 권한 테스트 시나리오

## 테스트 개요
- **테스트 대상**: 대리점 서브관리자
- **테스트 목적**: 대리점 서브관리자의 제한된 권한 동작 검증
- **상위 계층**: 특정 대리점 소속

## 사전 조건
- 대리점 최고관리자 계정이 생성되어 있어야 함 (예: a_test_01)
- 대리점 서브관리자 계정이 생성되어 있어야 함 (예: a_order_sub_01)
- g5_auth 테이블에 서브관리자 권한이 설정되어 있어야 함

## 테스트 시나리오

### 1. 서브관리자 계정 생성 및 권한 부여

#### 1.1 대리점 최고관리자로 서브관리자 생성
1. 대리점 최고관리자(a_test_01)로 로그인
2. [관리자 관리] > "서브관리자 관리" 메뉴 접속
3. "+ 서브관리자 등록" 버튼 클릭
4. 서브관리자 정보 입력:
   - 관리자 ID: `a_order_sub_01`
   - 비밀번호: `a_order_sub_01`
   - 이름: `대리점주문담당`
   - 이메일: `a_order_sub_01@gmail.com`
5. 권한 설정:
   - ✓ 지점 조회
   - ✓ 지점 등록
   - ✓ 지점 수정
   - ✗ 지점 삭제
   - ✓ 주문 조회
   - ✓ 주문 처리
   - ✗ 상품 관리
6. "서브관리자 등록" 버튼 클릭
7. **검증**:
   - 서브관리자가 성공적으로 생성되는지 확인
   - g5_auth 테이블에 권한이 올바르게 저장되는지 확인

### 2. 서브관리자 로그인 및 메뉴 접근

#### 2.1 로그인 및 메뉴 표시
1. 서브관리자(a_order_sub_01)로 로그인
2. **검증**:
   - 로그인이 성공하는지 확인
   - 권한이 있는 메뉴만 표시되는지 확인
   - 상위 계층(총판) 메뉴는 표시되지 않는지 확인

### 3. 지점 관리 권한 테스트

#### 3.1 지점 조회 권한 (허용됨)
1. [프랜차이즈 관리] > "지점관리" 메뉴 클릭
2. **검증**:
   - 지점 목록 페이지에 접근 가능한지 확인
   - 자신이 속한 대리점(a_test_01) 소속 지점만 표시되는지 확인
   - Chained Select에서 총판/대리점이 자동으로 고정되어 있는지 확인

#### 3.2 지점 등록 권한 (허용됨)
1. "+ 지점 등록" 버튼 클릭
2. 지점 정보 입력:
   - 지점 ID: `b_sub_test_01`
   - 비밀번호: `b_sub_test_01`
   - 지점명: `서브테스트지점`
   - 회사명: `서브테스트지점`
3. "확인" 버튼 클릭
4. **검증**:
   - 지점이 성공적으로 등록되는지 확인
   - 등록된 지점의 소속 대리점이 자동으로 a_test_01로 설정되는지 확인
   - 소속 총판도 자동으로 상위 총판으로 설정되는지 확인

#### 3.3 지점 수정 권한 (허용됨)
1. 등록된 지점의 "수정" 버튼 클릭
2. 회사명 변경: `서브테스트지점` → `서브테스트지점2`
3. "지점 정보 수정" 버튼 클릭
4. **검증**:
   - 수정이 성공적으로 완료되는지 확인
   - 소속 대리점/총판은 변경할 수 없는지 확인

#### 3.4 지점 삭제 권한 (차단됨)
1. 지점 목록에서 "삭제" 버튼 확인
2. **검증**:
   - 삭제 버튼이 비활성화되어 있거나 숨김 처리되는지 확인
   - 직접 삭제 요청 시 권한 오류가 발생하는지 확인

### 4. 주문 관리 권한 테스트

#### 4.1 주문 조회 권한 (허용됨)
1. [주문 관리] > "주문 목록" 메뉴 클릭
2. **검증**:
   - 주문 목록 페이지에 접근 가능한지 확인
   - 자신이 속한 대리점 및 하위 지점의 주문만 표시되는지 확인
   - 다른 대리점의 주문은 표시되지 않는지 확인

#### 4.2 주문 처리 권한 (허용됨)
1. 주문 상세 페이지에서 주문 상태 변경
2. **검증**:
   - 주문 상태 변경이 가능한지 확인
   - 변경 이력이 기록되는지 확인

### 5. 상위 계층 접근 테스트

#### 5.1 총판 메뉴 접근 (차단됨)
1. 총판 관련 메뉴 접근 시도
2. **검증**:
   - 총판 관련 메뉴가 표시되지 않는지 확인
   - URL 직접 접근 시 권한 오류가 발생하는지 확인

#### 5.2 대리점 정보 수정 (차단됨)
1. 자신이 속한 대리점 정보 수정 시도
2. **검증**:
   - 대리점 정보 수정 권한이 없음을 확인
   - 서브관리자는 자신이 속한 계층 정보를 변경할 수 없음을 확인

### 6. 동일 계층 타 조직 접근 테스트

#### 6.1 다른 대리점 데이터 접근 (차단됨)
1. URL 조작을 통해 다른 대리점의 지점 데이터 접근 시도
2. **검증**:
   - 접근이 차단되는지 확인
   - 적절한 권한 오류 메시지가 표시되는지 확인

### 7. 상품 관리 권한 테스트

#### 7.1 상품 관리 접근 (차단됨)
1. 상품 관리 메뉴 접근 시도
2. **검증**:
   - 상품 관리 메뉴가 표시되지 않는지 확인
   - 권한이 없는 기능에는 접근할 수 없음을 확인

### 8. 계층 구조 제약 테스트

#### 8.1 상위 총판 변경 시도 (차단됨)
1. 지점 등록/수정 시 다른 총판 선택 시도
2. **검증**:
   - 총판 선택이 비활성화되어 있는지 확인
   - 자신이 속한 계층 구조를 벗어날 수 없음을 확인

## 예상 결과

대리점 서브관리자는:
- 부여받은 권한 범위 내에서만 기능 사용 가능
- 자신이 속한 대리점과 그 하위 지점만 접근 가능
- 상위 계층(본사, 총판) 및 동일 계층 타 조직 접근 불가
- 주문 관리 등 부여받은 추가 권한 사용 가능

## 테스트 데이터
```
계정 정보:
- 대리점 최고관리자: a_test_01 / a_test_01
- 대리점 서브관리자: a_order_sub_01 / a_order_sub_01

권한 설정 (g5_auth):
- au_menu: 지점관리, 주문관리
- au_auth: r (읽기), w (쓰기), d (삭제 - 지점 삭제 제외)

계층 구조:
- 총판: d_test_01
  └─ 대리점: a_test_01
      └─ 지점: b_test_01, b_sub_test_01
```

## 주의사항
- 대리점 서브관리자는 지점 관리에 대해 더 많은 권한을 가질 수 있음
- 주문 관리 등 업무별 권한이 추가로 부여될 수 있음
- Chained Select에서 상위 계층이 자동으로 고정됨